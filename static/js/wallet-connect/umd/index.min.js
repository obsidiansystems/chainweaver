!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WalletConnectClient",[],t):"object"==typeof exports?exports.WalletConnectClient=t():e.WalletConnectClient=t()}(this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=86)}([function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"h",(function(){return s})),r.d(t,"a",(function(){return a})),r.d(t,"g",(function(){return c})),r.d(t,"f",(function(){return u})),r.d(t,"n",(function(){return d})),r.d(t,"o",(function(){return l})),r.d(t,"j",(function(){return f})),r.d(t,"i",(function(){return h})),r.d(t,"m",(function(){return p})),r.d(t,"e",(function(){return g})),r.d(t,"k",(function(){return n})),r.d(t,"l",(function(){return i})),r.d(t,"d",(function(){return E})),r.d(t,"c",(function(){return y})),r.d(t,"p",(function(){return _})),r.d(t,"q",(function(){return v}));const n=0,i=512,o=256,s=256,a="AES-CBC",c="SHA-"+o,u="HMAC",d="SHA-256",l="SHA-512",f=32,h=16,p=32,g="Bad MAC",E="encrypt",y="decrypt",_="sign",v="verify"},function(e,t,r){"use strict";(function(e){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.removeHexLeadingZeros=t.sanitizeHex=t.addHexPrefix=t.removeHexPrefix=t.padRight=t.padLeft=t.sanitizeBytes=t.swapHex=t.swapBytes=t.splitBytes=t.calcByteLength=t.trimRight=t.trimLeft=t.concatArrays=t.concatBuffers=t.getEncoding=t.getType=t.isArrayBuffer=t.isTypedArray=t.isBuffer=t.isHexString=t.isBinaryString=t.binaryToNumber=t.binaryToUtf8=t.binaryToHex=t.binaryToArray=t.binaryToBuffer=t.numberToBinary=t.numberToUtf8=t.numberToHex=t.numberToArray=t.numberToBuffer=t.utf8ToBinary=t.utf8ToNumber=t.utf8ToHex=t.utf8ToArray=t.utf8ToBuffer=t.hexToBinary=t.hexToNumber=t.hexToUtf8=t.hexToArray=t.hexToBuffer=t.arrayToBinary=t.arrayToNumber=t.arrayToUtf8=t.arrayToHex=t.arrayToBuffer=t.bufferToBinary=t.bufferToNumber=t.bufferToUtf8=t.bufferToHex=t.bufferToArray=void 0;const i=n(r(68)),o=n(r(99));function s(e){return new Uint8Array(e)}function a(e,t=!1){const r=e.toString("hex");return t?x(r):r}function c(e){return e.toString("utf8")}function u(e){return e.readUIntBE(0,e.length)}function d(e){return o.default(e)}function l(e,t=!1){return a(d(e),t)}function f(e){return c(d(e))}function h(e){return u(d(e))}function p(e){return Array.from(e).map(R).join("")}function g(t){return e.from(D(t),"hex")}function E(e){return s(g(e))}function y(e){return p(E(e))}function _(t){return e.from(t,"utf8")}function v(e){return s(_(e))}function R(e){return L((e>>>0).toString(2))}function m(e){return d(S(e))}function S(e){return new Uint8Array(P(e).map(e=>parseInt(e,2)))}function T(e,t){return l(S(e),t)}function O(e){return!("string"!=typeof e||!new RegExp(/^[01]+$/).test(e))&&e.length%8==0}function b(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}function N(t){return e.isBuffer(t)}function I(e){return i.default.strict(e)&&!N(e)}function w(e){return!I(e)&&!N(e)&&void 0!==e.byteLength}function A(e,t=8){const r=e%t;return r?(e-r)/t*t+t:e}function P(e,t=8){const r=L(e).match(new RegExp(`.{${t}}`,"gi"));return Array.from(r||[])}function C(e){return P(e).map(M).join("")}function L(e,t=8,r="0"){return U(e,A(e.length,t),r)}function U(e,t,r="0"){return q(e,t,!0,r)}function D(e){return e.replace(/^0x/,"")}function x(e){return e.startsWith("0x")?e:"0x"+e}function M(e){return e.split("").reverse().join("")}function q(e,t,r,n="0"){const i=t-e.length;let o=e;if(i>0){const t=n.repeat(i);o=r?t+e:e+t}return o}t.bufferToArray=s,t.bufferToHex=a,t.bufferToUtf8=c,t.bufferToNumber=u,t.bufferToBinary=function(e){return p(s(e))},t.arrayToBuffer=d,t.arrayToHex=l,t.arrayToUtf8=f,t.arrayToNumber=h,t.arrayToBinary=p,t.hexToBuffer=g,t.hexToArray=E,t.hexToUtf8=function(e){return c(g(e))},t.hexToNumber=function(e){return h(E(e))},t.hexToBinary=y,t.utf8ToBuffer=_,t.utf8ToArray=v,t.utf8ToHex=function(e,t=!1){return a(_(e),t)},t.utf8ToNumber=function(e){const t=parseInt(e,10);return function(e,t){if(!e)throw new Error(t)}(!function(e){return void 0===e}(t),"Number can only safely store up to 53 bits"),t},t.utf8ToBinary=function(e){return p(v(e))},t.numberToBuffer=function(e){return m(R(e))},t.numberToArray=function(e){return S(R(e))},t.numberToHex=function(e,t){return T(R(e),t)},t.numberToUtf8=function(e){return""+e},t.numberToBinary=R,t.binaryToBuffer=m,t.binaryToArray=S,t.binaryToHex=T,t.binaryToUtf8=function(e){return f(S(e))},t.binaryToNumber=function(e){return h(S(e))},t.isBinaryString=O,t.isHexString=b,t.isBuffer=N,t.isTypedArray=I,t.isArrayBuffer=w,t.getType=function(e){return N(e)?"buffer":I(e)?"typed-array":w(e)?"array-buffer":Array.isArray(e)?"array":typeof e},t.getEncoding=function(e){return O(e)?"binary":b(e)?"hex":"utf8"},t.concatBuffers=function(...t){return e.concat(t)},t.concatArrays=function(...e){let t=[];return e.forEach(e=>t=t.concat(Array.from(e))),new Uint8Array([...t])},t.trimLeft=function(e,t){const r=e.length-t;return r>0&&(e=e.slice(r)),e},t.trimRight=function(e,t){return e.slice(0,t)},t.calcByteLength=A,t.splitBytes=P,t.swapBytes=C,t.swapHex=function(e){return T(C(y(e)))},t.sanitizeBytes=L,t.padLeft=U,t.padRight=function(e,t,r="0"){return q(e,t,!1,r)},t.removeHexPrefix=D,t.addHexPrefix=x,t.sanitizeHex=function(e){return(e=L(e=D(e),2))&&(e=x(e)),e},t.removeHexLeadingZeros=function(e){const t=e.startsWith("0x");return e=(e=D(e)).startsWith("0")?e.substring(1):e,t?x(e):e}}).call(this,r(67).Buffer)},function(e,t,r){"use strict";r.r(t);var n=r(39);for(var i in n)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i);var o=r(26);r.d(t,"IEvents",(function(){return o.a}));var s=r(40);r.d(t,"IJsonRpcConnection",(function(){return s.b})),r.d(t,"IBaseJsonRpcProvider",(function(){return s.a})),r.d(t,"IJsonRpcProvider",(function(){return s.c}));var a=r(41);for(var i in a)["default","IEvents","IJsonRpcConnection","IBaseJsonRpcProvider","IJsonRpcProvider"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(i)},function(e,t,r){"use strict";var n=r(57);r.d(t,"randomBytes",(function(){return n.a}));var i=r(59);r.d(t,"aesCbcDecrypt",(function(){return i.a})),r.d(t,"aesCbcEncrypt",(function(){return i.b}));var o=r(60);r.d(t,"hmacSha256Sign",(function(){return o.a})),r.d(t,"hmacSha256Verify",(function(){return o.b}));var s=r(65);r.d(t,"sha256",(function(){return s.a})),r.d(t,"sha512",(function(){return s.b}));var a=r(27);r.o(a,"ERROR_BAD_MAC")&&r.d(t,"ERROR_BAD_MAC",(function(){return a.ERROR_BAD_MAC})),r.o(a,"IV_LENGTH")&&r.d(t,"IV_LENGTH",(function(){return a.IV_LENGTH})),r.o(a,"KEY_LENGTH")&&r.d(t,"KEY_LENGTH",(function(){return a.KEY_LENGTH})),r.o(a,"LENGTH_0")&&r.d(t,"LENGTH_0",(function(){return a.LENGTH_0})),r.o(a,"MAC_LENGTH")&&r.d(t,"MAC_LENGTH",(function(){return a.MAC_LENGTH})),r.o(a,"assert")&&r.d(t,"assert",(function(){return a.assert})),r.o(a,"decryptWithSharedKey")&&r.d(t,"decryptWithSharedKey",(function(){return a.decryptWithSharedKey})),r.o(a,"derive")&&r.d(t,"derive",(function(){return a.derive})),r.o(a,"encryptWithSharedKey")&&r.d(t,"encryptWithSharedKey",(function(){return a.encryptWithSharedKey})),r.o(a,"generateKeyPair")&&r.d(t,"generateKeyPair",(function(){return a.generateKeyPair}));var c=r(0);r.d(t,"ERROR_BAD_MAC",(function(){return c.e})),r.d(t,"IV_LENGTH",(function(){return c.i})),r.d(t,"KEY_LENGTH",(function(){return c.j})),r.d(t,"LENGTH_0",(function(){return c.k})),r.d(t,"MAC_LENGTH",(function(){return c.m}))},function(e,t,r){"use strict";r.d(t,"e",(function(){return n})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return a})),r.d(t,"g",(function(){return c})),r.d(t,"f",(function(){return u})),r.d(t,"h",(function(){return d})),r.d(t,"i",(function(){return l}));const n="PARSE_ERROR",i="INVALID_REQUEST",o="METHOD_NOT_FOUND",s="INVALID_PARAMS",a="INTERNAL_ERROR",c="SERVER_ERROR",u=[-32700,-32600,-32601,-32602,-32603],d=[-32e3,-32099],l={[n]:{code:-32700,message:"Parse error"},[i]:{code:-32600,message:"Invalid Request"},[o]:{code:-32601,message:"Method not found"},[s]:{code:-32602,message:"Invalid params"},[a]:{code:-32603,message:"Internal error"},[c]:{code:-32e3,message:"Server error"}}},function(e,t,r){"use strict";r.r(t),r.d(t,"__extends",(function(){return i})),r.d(t,"__assign",(function(){return o})),r.d(t,"__rest",(function(){return s})),r.d(t,"__decorate",(function(){return a})),r.d(t,"__param",(function(){return c})),r.d(t,"__metadata",(function(){return u})),r.d(t,"__awaiter",(function(){return d})),r.d(t,"__generator",(function(){return l})),r.d(t,"__createBinding",(function(){return f})),r.d(t,"__exportStar",(function(){return h})),r.d(t,"__values",(function(){return p})),r.d(t,"__read",(function(){return g})),r.d(t,"__spread",(function(){return E})),r.d(t,"__spreadArrays",(function(){return y})),r.d(t,"__await",(function(){return _})),r.d(t,"__asyncGenerator",(function(){return v})),r.d(t,"__asyncDelegator",(function(){return R})),r.d(t,"__asyncValues",(function(){return m})),r.d(t,"__makeTemplateObject",(function(){return S})),r.d(t,"__importStar",(function(){return T})),r.d(t,"__importDefault",(function(){return O})),r.d(t,"__classPrivateFieldGet",(function(){return b})),r.d(t,"__classPrivateFieldSet",(function(){return N}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function i(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function a(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}function c(e,t){return function(r,n){t(r,n,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function d(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function l(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function f(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}function h(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||(t[r]=e[r])}function p(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function E(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}function y(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n}function _(e){return this instanceof _?(this.v=e,this):new _(e)}function v(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||a(e,t)}))})}function a(e,t){try{(r=i[e](t)).value instanceof _?Promise.resolve(r.value.v).then(c,u):d(o[0][2],r)}catch(e){d(o[0][3],e)}var r}function c(e){a("next",e)}function u(e){a("throw",e)}function d(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function R(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:_(e[n](t)),done:"return"===n}:i?i(t):t}:i}}function m(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=p(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}}function S(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function O(e){return e&&e.__esModule?e:{default:e}}function b(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function N(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(94),t),i(r(95),t)},function(e,t,r){"use strict";function n(e,t,r="string"){if(!e[t]||typeof e[t]!==r)throw new Error(`Missing or invalid "${t}" param`)}function i(e,t,r){return!!(!r.length?function(e,t){return Array.isArray(e)?e.length===t:Object.keys(e).length===t}(e,t.length):function(e,t){return Array.isArray(e)?e.length>=t:Object.keys(e).length>=t}(e,t.length))&&function(e,t){let r=!0;return t.forEach(t=>{t in e||(r=!1)}),r}(e,t)}function o(e,t,r="_"){const n=e.split(r);return n[n.length-1].trim().toLowerCase()===t.trim().toLowerCase()}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return o}))},function(e,t,r){"use strict";r.r(t);var n=r(4);r.d(t,"PARSE_ERROR",(function(){return n.e})),r.d(t,"INVALID_REQUEST",(function(){return n.c})),r.d(t,"METHOD_NOT_FOUND",(function(){return n.d})),r.d(t,"INVALID_PARAMS",(function(){return n.b})),r.d(t,"INTERNAL_ERROR",(function(){return n.a})),r.d(t,"SERVER_ERROR",(function(){return n.g})),r.d(t,"RESERVED_ERROR_CODES",(function(){return n.f})),r.d(t,"SERVER_ERROR_CODE_RANGE",(function(){return n.h})),r.d(t,"STANDARD_ERROR_MAP",(function(){return n.i}));var i=r(20);r.d(t,"isServerErrorCode",(function(){return i.d})),r.d(t,"isReservedErrorCode",(function(){return i.c})),r.d(t,"isValidErrorCode",(function(){return i.e})),r.d(t,"getError",(function(){return i.a})),r.d(t,"getErrorByCode",(function(){return i.b})),r.d(t,"validateJsonRpcError",(function(){return i.g})),r.d(t,"parseConnectionError",(function(){return i.f}));var o=r(72);for(var s in o)["default","PARSE_ERROR","INVALID_REQUEST","METHOD_NOT_FOUND","INVALID_PARAMS","INTERNAL_ERROR","SERVER_ERROR","RESERVED_ERROR_CODES","SERVER_ERROR_CODE_RANGE","STANDARD_ERROR_MAP","isServerErrorCode","isReservedErrorCode","isValidErrorCode","getError","getErrorByCode","validateJsonRpcError","parseConnectionError"].indexOf(s)<0&&function(e){r.d(t,e,(function(){return o[e]}))}(s);var a=r(73);r.d(t,"payloadId",(function(){return a.e})),r.d(t,"formatJsonRpcRequest",(function(){return a.c})),r.d(t,"formatJsonRpcResult",(function(){return a.d})),r.d(t,"formatJsonRpcError",(function(){return a.b})),r.d(t,"formatErrorMessage",(function(){return a.a}));var c=r(74);r.d(t,"isValidRoute",(function(){return c.c})),r.d(t,"isValidDefaultRoute",(function(){return c.a})),r.d(t,"isValidWildcardRoute",(function(){return c.e})),r.d(t,"isValidLeadingWildcardRoute",(function(){return c.b})),r.d(t,"isValidTrailingWildcardRoute",(function(){return c.d}));var u=r(75);for(var s in u)["default","PARSE_ERROR","INVALID_REQUEST","METHOD_NOT_FOUND","INVALID_PARAMS","INTERNAL_ERROR","SERVER_ERROR","RESERVED_ERROR_CODES","SERVER_ERROR_CODE_RANGE","STANDARD_ERROR_MAP","isServerErrorCode","isReservedErrorCode","isValidErrorCode","getError","getErrorByCode","validateJsonRpcError","parseConnectionError","payloadId","formatJsonRpcRequest","formatJsonRpcResult","formatJsonRpcError","formatErrorMessage","isValidRoute","isValidDefaultRoute","isValidWildcardRoute","isValidLeadingWildcardRoute","isValidTrailingWildcardRoute"].indexOf(s)<0&&function(e){r.d(t,e,(function(){return u[e]}))}(s);var d=r(76);r.d(t,"isHttpUrl",(function(){return d.a})),r.d(t,"isWsUrl",(function(){return d.c})),r.d(t,"isLocalhostUrl",(function(){return d.b}));var l=r(77);r.d(t,"isJsonRpcPayload",(function(){return l.b})),r.d(t,"isJsonRpcRequest",(function(){return l.c})),r.d(t,"isJsonRpcResponse",(function(){return l.d})),r.d(t,"isJsonRpcResult",(function(){return l.e})),r.d(t,"isJsonRpcError",(function(){return l.a})),r.d(t,"isJsonRpcValidationInvalid",(function(){return l.f}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5);n.__exportStar(r(114),t),n.__exportStar(r(115),t),n.__exportStar(r(116),t),n.__exportStar(r(117),t),n.__exportStar(r(118),t),n.__exportStar(r(119),t),n.__exportStar(r(120),t),n.__exportStar(r(121),t),n.__exportStar(r(122),t),n.__exportStar(r(123),t),n.__exportStar(r(124),t),n.__exportStar(r(125),t),n.__exportStar(r(126),t),n.__exportStar(r(18),t)},function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}y(e,t,o,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&y(e,"error",t,r)}(e,i,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var i,o,s,a;if(u(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=d(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=f.bind(n);return i.listener=r,n.wrapFn=i,i}function p(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):E(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function E(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function y(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),r(o)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return d(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,d=E(c,u);for(r=0;r<u;++r)o(d[r],this,t)}return!0},a.prototype.addListener=function(e,t){return l(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return l(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,i,o,s;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=function(e){return p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},a.prototype.listenerCount=g,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(78),t),i(r(111),t)},function(e,t,r){"use strict";r.r(t),r.d(t,"generateKeyPair",(function(){return o})),r.d(t,"generateRandomBytes32",(function(){return s})),r.d(t,"deriveSharedKey",(function(){return a})),r.d(t,"sha256",(function(){return c})),r.d(t,"encrypt",(function(){return u})),r.d(t,"decrypt",(function(){return d})),r.d(t,"ERROR_TYPE",(function(){return f})),r.d(t,"ERROR",(function(){return _})),r.d(t,"REACT_NATIVE_PRODUCT",(function(){return l.f})),r.d(t,"ENV_MAP",(function(){return l.d})),r.d(t,"EMPTY_SPACE",(function(){return l.c})),r.d(t,"COLON",(function(){return l.a})),r.d(t,"SLASH",(function(){return l.g})),r.d(t,"DEFAULT_DEPTH",(function(){return l.b})),r.d(t,"ONE_THOUSAND",(function(){return l.e})),r.d(t,"isNode",(function(){return l.x})),r.d(t,"isReactNative",(function(){return l.y})),r.d(t,"isBrowser",(function(){return l.w})),r.d(t,"getEnvironment",(function(){return l.s})),r.d(t,"appendToQueryString",(function(){return l.h})),r.d(t,"getAppMetadata",(function(){return l.r})),r.d(t,"getRelayClientMetadata",(function(){return l.u})),r.d(t,"formatRelayRpcUrl",(function(){return l.o})),r.d(t,"assertType",(function(){return l.i})),r.d(t,"parseContextNames",(function(){return l.D})),r.d(t,"formatMessageContext",(function(){return l.n})),r.d(t,"formatStorageKeyName",(function(){return l.p})),r.d(t,"hasOverlap",(function(){return l.v})),r.d(t,"getLastItems",(function(){return l.t})),r.d(t,"mergeArrays",(function(){return l.B})),r.d(t,"mapToObj",(function(){return l.A})),r.d(t,"objToMap",(function(){return l.C})),r.d(t,"mapEntries",(function(){return l.z})),r.d(t,"enumify",(function(){return l.m})),r.d(t,"capitalizeWord",(function(){return l.l})),r.d(t,"capitalize",(function(){return l.k})),r.d(t,"toMiliseconds",(function(){return l.E})),r.d(t,"fromMiliseconds",(function(){return l.q})),r.d(t,"calcExpiry",(function(){return l.j})),r.d(t,"RELAYER_DEFAULT_PROTOCOL",(function(){return R})),r.d(t,"getRelayProtocolName",(function(){return m})),r.d(t,"getRelayProtocolApi",(function(){return S})),r.d(t,"formatUri",(function(){return b})),r.d(t,"parseUri",(function(){return N})),r.d(t,"isSignalTypePairing",(function(){return I})),r.d(t,"isSignalTypeUri",(function(){return w})),r.d(t,"isSequenceRespondedStatus",(function(){return A})),r.d(t,"isSequenceResponded",(function(){return P})),r.d(t,"isSequenceRejected",(function(){return C})),r.d(t,"isSequenceFailed",(function(){return L})),r.d(t,"isPairingRespondedStatus",(function(){return U})),r.d(t,"isPairingResponded",(function(){return D})),r.d(t,"isPairingRejected",(function(){return x})),r.d(t,"isPairingFailed",(function(){return M})),r.d(t,"isSessionRespondedStatus",(function(){return q})),r.d(t,"isSessionResponded",(function(){return j})),r.d(t,"isSessionRejected",(function(){return H})),r.d(t,"isSessionFailed",(function(){return V})),r.d(t,"isStoreUpdatedEvent",(function(){return B})),r.d(t,"validateSessionProposeParamsPermissions",(function(){return K})),r.d(t,"validateSessionProposeParamsMetadata",(function(){return G})),r.d(t,"validateSessionProposeParams",(function(){return k})),r.d(t,"validateSessionRespondParams",(function(){return Y})),r.d(t,"validateBlockchainPermissions",(function(){return J})),r.d(t,"validateJsonRpcPermissions",(function(){return F})),r.d(t,"validateNotificationPermissions",(function(){return z})),r.d(t,"validateBlockchainState",(function(){return W})),r.d(t,"isValidArray",(function(){return X})),r.d(t,"isValidString",(function(){return Q})),r.d(t,"isValidChainId",(function(){return $})),r.d(t,"isValidAccountId",(function(){return Z})),r.d(t,"isValidUrl",(function(){return ee})),r.d(t,"isValidationInvalid",(function(){return te})),r.d(t,"formatValidResult",(function(){return re})),r.d(t,"formatInvalidResult",(function(){return ne}));var n=r(21),i=r(1);function o(){const e=n.generateKeyPair();return{privateKey:i.arrayToHex(e.privateKey),publicKey:i.arrayToHex(e.publicKey)}}function s(){return i.arrayToHex(n.randomBytes(32))}function a(e,t){const r=n.derive(i.hexToArray(e),i.hexToArray(t));return i.arrayToHex(r)}async function c(e){const t=await n.sha256(i.hexToArray(e));return i.arrayToHex(t)}async function u(e){const t=i.utf8ToArray(e.message),r=i.hexToArray(e.sharedKey),o=i.hexToArray(e.publicKey),s=void 0!==e.iv?i.hexToArray(e.iv):void 0,a=await n.encryptWithSharedKey(t,r,o,s);return i.arrayToHex(a)}async function d(e){const t=i.hexToArray(e.encrypted),r=i.hexToArray(e.sharedKey),o=await n.decryptWithSharedKey(t,r);return i.arrayToUtf8(o)}var l=r(13);const f=Object(l.m)({GENERIC:"GENERIC",MISSING_OR_INVALID:"MISSING_OR_INVALID",MISSING_RESPONSE:"MISSING_RESPONSE",MISSING_DECRYPT_PARAMS:"MISSING_DECRYPT_PARAMS",INVALID_UPDATE_REQUEST:"INVALID_UPDATE_REQUEST",INVALID_UPGRADE_REQUEST:"INVALID_UPGRADE_REQUEST",INVALID_STORAGE_KEY_NAME:"INVALID_STORAGE_KEY_NAME",RECORD_ALREADY_EXISTS:"RECORD_ALREADY_EXISTS",RESTORE_WILL_OVERRIDE:"RESTORE_WILL_OVERRIDE",NO_MATCHING_ID:"NO_MATCHING_ID",NO_MATCHING_TOPIC:"NO_MATCHING_TOPIC",NO_MATCHING_RESPONSE:"NO_MATCHING_RESPONSE",NO_MATCHING_KEY:"NO_MATCHING_KEY",UNKNOWN_JSONRPC_METHOD:"UNKNOWN_JSONRPC_METHOD",MISMATCHED_TOPIC:"MISMATCHED_TOPIC",MISMATCHED_ACCOUNTS:"MISMATCHED_ACCOUNTS",SETTLED:"SETTLED",NOT_APPROVED:"NOT_APPROVED",PROPOSAL_RESPONDED:"PROPOSAL_RESPONDED",RESPONSE_ACKNOWLEDGED:"RESPONSE_ACKNOWLEDGED",EXPIRED:"EXPIRED",DELETED:"DELETED",RESUBSCRIBED:"RESUBSCRIBED",SETTLE_TIMEOUT:"SETTLE_TIMEOUT",JSONRPC_REQUEST_TIMEOUT:"JSONRPC_REQUEST_TIMEOUT",UNAUTHORIZED_TARGET_CHAIN:"UNAUTHORIZED_TARGET_CHAIN",UNAUTHORIZED_JSON_RPC_METHOD:"UNAUTHORIZED_JSON_RPC_METHOD",UNAUTHORIZED_NOTIFICATION_TYPE:"UNAUTHORIZED_NOTIFICATION_TYPE",UNAUTHORIZED_UPDATE_REQUEST:"UNAUTHORIZED_UPDATE_REQUEST",UNAUTHORIZED_UPGRADE_REQUEST:"UNAUTHORIZED_UPGRADE_REQUEST",UNAUTHORIZED_MATCHING_CONTROLLER:"UNAUTHORIZED_MATCHING_CONTROLLER",JSONRPC_REQUEST_METHOD_REJECTED:"JSONRPC_REQUEST_METHOD_REJECTED",JSONRPC_REQUEST_METHOD_UNAUTHORIZED:"JSONRPC_REQUEST_METHOD_UNAUTHORIZED",JSONRPC_REQUEST_METHOD_UNSUPPORTED:"JSONRPC_REQUEST_METHOD_UNSUPPORTED",DISCONNECTED_ALL_CHAINS:"DISCONNECTED_ALL_CHAINS",DISCONNECTED_TARGET_CHAIN:"DISCONNECTED_TARGET_CHAIN",DISAPPROVED_CHAINS:"DISAPPROVED_CHAINS",DISAPPROVED_JSONRPC:"DISAPPROVED_JSONRPC",DISAPPROVED_NOTIFICATION:"DISAPPROVED_NOTIFICATION",UNSUPPORTED_CHAINS:"UNSUPPORTED_CHAINS",UNSUPPORTED_JSONRPC:"UNSUPPORTED_JSONRPC",UNSUPPORTED_NOTIFICATION:"UNSUPPORTED_NOTIFICATION",UNSUPPORTED_SIGNAL:"UNSUPPORTED_SIGNAL",USER_DISCONNECTED:"USER_DISCONNECTED",UNKNOWN:"UNKNOWN"}),h="undefined",p="Something went wrong",g="parameter",E="session",y="Ethereum",_={[f.GENERIC]:{type:f.GENERIC,code:0,stringify:e=>(null==e?void 0:e.message)||p,format:e=>({code:_[f.GENERIC].code,message:_[f.GENERIC].stringify(e)})},[f.MISSING_OR_INVALID]:{type:f.MISSING_OR_INVALID,code:1e3,stringify:e=>"Missing or invalid "+((null==e?void 0:e.name)||g),format:e=>({code:_[f.MISSING_OR_INVALID].code,message:_[f.MISSING_OR_INVALID].stringify(e)})},[f.MISSING_RESPONSE]:{type:f.MISSING_RESPONSE,code:1001,stringify:e=>`Response is required for approved ${(null==e?void 0:e.context)||E} proposals`,format:e=>({code:_[f.MISSING_RESPONSE].code,message:_[f.MISSING_RESPONSE].stringify(e)})},[f.MISSING_DECRYPT_PARAMS]:{type:f.MISSING_DECRYPT_PARAMS,code:1002,stringify:e=>"Decrypt params required for "+((null==e?void 0:e.context)||E),format:e=>({code:_[f.MISSING_DECRYPT_PARAMS].code,message:_[f.MISSING_DECRYPT_PARAMS].stringify(e)})},[f.INVALID_UPDATE_REQUEST]:{type:f.INVALID_UPDATE_REQUEST,code:1003,stringify:e=>`Invalid ${(null==e?void 0:e.context)||E} update request`,format:e=>({code:_[f.INVALID_UPDATE_REQUEST].code,message:_[f.INVALID_UPDATE_REQUEST].stringify(e)})},[f.INVALID_UPGRADE_REQUEST]:{type:f.INVALID_UPGRADE_REQUEST,code:1004,stringify:e=>`Invalid ${(null==e?void 0:e.context)||E} upgrade request`,format:e=>({code:_[f.INVALID_UPGRADE_REQUEST].code,message:_[f.INVALID_UPGRADE_REQUEST].stringify(e)})},[f.INVALID_STORAGE_KEY_NAME]:{type:f.INVALID_STORAGE_KEY_NAME,code:1005,stringify:e=>"Invalid storage key name: "+((null==e?void 0:e.name)||g),format:e=>({code:_[f.INVALID_STORAGE_KEY_NAME].code,message:_[f.INVALID_STORAGE_KEY_NAME].stringify(e)})},[f.RECORD_ALREADY_EXISTS]:{type:f.RECORD_ALREADY_EXISTS,code:1100,stringify:e=>`Record already exists for ${(null==e?void 0:e.context)||E} matching id: ${null==e?void 0:e.id}`,format:e=>({code:_[f.RECORD_ALREADY_EXISTS].code,message:_[f.RECORD_ALREADY_EXISTS].stringify(e)})},[f.RESTORE_WILL_OVERRIDE]:{type:f.RESTORE_WILL_OVERRIDE,code:1200,stringify:e=>"Restore will override already set "+((null==e?void 0:e.context)||E),format:e=>({code:_[f.RESTORE_WILL_OVERRIDE].code,message:_[f.RESTORE_WILL_OVERRIDE].stringify(e)})},[f.NO_MATCHING_ID]:{type:f.NO_MATCHING_ID,code:1300,stringify:e=>`No matching ${(null==e?void 0:e.context)||E} with id: ${null==e?void 0:e.id}`,format:e=>({code:_[f.NO_MATCHING_ID].code,message:_[f.NO_MATCHING_ID].stringify(e)})},[f.NO_MATCHING_TOPIC]:{type:f.NO_MATCHING_TOPIC,code:1301,stringify:e=>`No matching ${(null==e?void 0:e.context)||E} with topic: ${null==e?void 0:e.topic}`,format:e=>({code:_[f.NO_MATCHING_TOPIC].code,message:_[f.NO_MATCHING_TOPIC].stringify(e)})},[f.NO_MATCHING_RESPONSE]:{type:f.NO_MATCHING_RESPONSE,code:1302,stringify:e=>`No response found in pending ${(null==e?void 0:e.context)||E} proposal`,format:e=>({code:_[f.NO_MATCHING_RESPONSE].code,message:_[f.NO_MATCHING_RESPONSE].stringify(e)})},[f.NO_MATCHING_KEY]:{type:f.NO_MATCHING_KEY,code:1303,stringify:e=>"No matching key with tag: "+(null==e?void 0:e.tag),format:e=>({code:_[f.NO_MATCHING_KEY].code,message:_[f.NO_MATCHING_KEY].stringify(e)})},[f.UNKNOWN_JSONRPC_METHOD]:{type:f.UNKNOWN_JSONRPC_METHOD,code:1400,stringify:e=>"Unknown JSON-RPC Method Requested: "+(null==e?void 0:e.method),format:e=>({code:_[f.UNKNOWN_JSONRPC_METHOD].code,message:_[f.UNKNOWN_JSONRPC_METHOD].stringify(e)})},[f.MISMATCHED_TOPIC]:{type:f.MISMATCHED_TOPIC,code:1500,stringify:e=>`Mismatched topic for ${(null==e?void 0:e.context)||E} with id: ${null==e?void 0:e.id}`,format:e=>({code:_[f.MISMATCHED_TOPIC].code,message:_[f.MISMATCHED_TOPIC].stringify(e)})},[f.MISMATCHED_ACCOUNTS]:{type:f.MISMATCHED_ACCOUNTS,code:1501,stringify:e=>"Invalid accounts with mismatched chains: "+(null==e?void 0:e.mismatched.toString()),format:e=>({code:_[f.MISMATCHED_ACCOUNTS].code,message:_[f.MISMATCHED_ACCOUNTS].stringify(e)})},[f.SETTLED]:{type:f.SETTLED,code:1600,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" settled",format:e=>({code:_[f.SETTLED].code,message:_[f.SETTLED].stringify(e)})},[f.NOT_APPROVED]:{type:f.NOT_APPROVED,code:1601,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" not approved",format:e=>({code:_[f.NOT_APPROVED].code,message:_[f.NOT_APPROVED].stringify(e)})},[f.PROPOSAL_RESPONDED]:{type:f.PROPOSAL_RESPONDED,code:1602,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" proposal responded",format:e=>({code:_[f.PROPOSAL_RESPONDED].code,message:_[f.PROPOSAL_RESPONDED].stringify(e)})},[f.RESPONSE_ACKNOWLEDGED]:{type:f.RESPONSE_ACKNOWLEDGED,code:1603,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" response acknowledge",format:e=>({code:_[f.RESPONSE_ACKNOWLEDGED].code,message:_[f.RESPONSE_ACKNOWLEDGED].stringify(e)})},[f.EXPIRED]:{type:f.EXPIRED,code:1604,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" expired",format:e=>({code:_[f.EXPIRED].code,message:_[f.EXPIRED].stringify(e)})},[f.DELETED]:{type:f.DELETED,code:1605,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" deleted",format:e=>({code:_[f.DELETED].code,message:_[f.DELETED].stringify(e)})},[f.RESUBSCRIBED]:{type:f.RESUBSCRIBED,code:1606,stringify:e=>"Subscription resubscribed with topic: "+(e.topic||h),format:e=>({code:_[f.RESUBSCRIBED].code,message:_[f.RESUBSCRIBED].stringify(e)})},[f.SETTLE_TIMEOUT]:{type:f.SETTLE_TIMEOUT,code:2e3,stringify:e=>`${Object(l.k)((null==e?void 0:e.context)||E)} failed to settle after ${Object(l.q)(null==e?void 0:e.timeout)} seconds`,format:e=>({code:_[f.SETTLE_TIMEOUT].code,message:_[f.SETTLE_TIMEOUT].stringify(e)})},[f.JSONRPC_REQUEST_TIMEOUT]:{type:f.JSONRPC_REQUEST_TIMEOUT,code:2001,stringify:e=>`JSON-RPC Request timeout after ${Object(l.q)(null==e?void 0:e.timeout)} seconds: ${null==e?void 0:e.method}`,format:e=>({code:_[f.JSONRPC_REQUEST_TIMEOUT].code,message:_[f.JSONRPC_REQUEST_TIMEOUT].stringify(e)})},[f.UNAUTHORIZED_TARGET_CHAIN]:{type:f.UNAUTHORIZED_TARGET_CHAIN,code:3e3,stringify:e=>"Unauthorized Target ChainId Requested: "+(null==e?void 0:e.chainId),format:e=>({code:_[f.UNAUTHORIZED_TARGET_CHAIN].code,message:_[f.UNAUTHORIZED_TARGET_CHAIN].stringify(e)})},[f.UNAUTHORIZED_JSON_RPC_METHOD]:{type:f.UNAUTHORIZED_JSON_RPC_METHOD,code:3001,stringify:e=>"Unauthorized JSON-RPC Method Requested: "+(null==e?void 0:e.method),format:e=>({code:_[f.UNAUTHORIZED_JSON_RPC_METHOD].code,message:_[f.UNAUTHORIZED_JSON_RPC_METHOD].stringify(e)})},[f.UNAUTHORIZED_NOTIFICATION_TYPE]:{type:f.UNAUTHORIZED_NOTIFICATION_TYPE,code:3002,stringify:e=>"Unauthorized Notification Type Requested: "+(null==e?void 0:e.type),format:e=>({code:_[f.UNAUTHORIZED_NOTIFICATION_TYPE].code,message:_[f.UNAUTHORIZED_NOTIFICATION_TYPE].stringify(e)})},[f.UNAUTHORIZED_UPDATE_REQUEST]:{type:f.UNAUTHORIZED_UPDATE_REQUEST,code:3003,stringify:e=>`Unauthorized ${(null==e?void 0:e.context)||E} update request`,format:e=>({code:_[f.UNAUTHORIZED_UPDATE_REQUEST].code,message:_[f.UNAUTHORIZED_UPDATE_REQUEST].stringify(e)})},[f.UNAUTHORIZED_UPGRADE_REQUEST]:{type:f.UNAUTHORIZED_UPGRADE_REQUEST,code:3004,stringify:e=>`Unauthorized ${(null==e?void 0:e.context)||E} upgrade request`,format:e=>({code:_[f.UNAUTHORIZED_UPGRADE_REQUEST].code,message:_[f.UNAUTHORIZED_UPGRADE_REQUEST].stringify(e)})},[f.UNAUTHORIZED_MATCHING_CONTROLLER]:{type:f.UNAUTHORIZED_MATCHING_CONTROLLER,code:3005,stringify:e=>`Unauthorized: peer is also ${(null==e?void 0:e.controller)?"":"not "}controller`,format:e=>({code:_[f.UNAUTHORIZED_MATCHING_CONTROLLER].code,message:_[f.UNAUTHORIZED_MATCHING_CONTROLLER].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_REJECTED]:{type:f.JSONRPC_REQUEST_METHOD_REJECTED,code:4001,stringify:e=>"User rejected the request.",format:e=>({code:_[f.JSONRPC_REQUEST_METHOD_REJECTED].code,message:_[f.JSONRPC_REQUEST_METHOD_REJECTED].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED]:{type:f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED,code:4100,stringify:e=>"The requested account and/or method has not been authorized by the user.",format:e=>({code:_[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED].code,message:_[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED]:{type:f.JSONRPC_REQUEST_METHOD_UNSUPPORTED,code:4200,stringify:e=>`The requested method is not supported by this ${(null==e?void 0:e.blockhain)||y} provider.`,format:e=>({code:_[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED].code,message:_[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED].stringify(e)})},[f.DISCONNECTED_ALL_CHAINS]:{type:f.DISCONNECTED_ALL_CHAINS,code:4900,stringify:e=>"The provider is disconnected from all chains.",format:e=>({code:_[f.DISCONNECTED_ALL_CHAINS].code,message:_[f.DISCONNECTED_ALL_CHAINS].stringify(e)})},[f.DISCONNECTED_TARGET_CHAIN]:{type:f.DISCONNECTED_TARGET_CHAIN,code:4901,stringify:e=>"The provider is disconnected from the specified chain.",format:e=>({code:_[f.DISCONNECTED_TARGET_CHAIN].code,message:_[f.DISCONNECTED_TARGET_CHAIN].stringify(e)})},[f.DISAPPROVED_CHAINS]:{type:f.DISAPPROVED_CHAINS,code:5e3,stringify:e=>"User disapproved requested chains",format:e=>({code:_[f.DISAPPROVED_CHAINS].code,message:_[f.DISAPPROVED_CHAINS].stringify(e)})},[f.DISAPPROVED_JSONRPC]:{type:f.DISAPPROVED_JSONRPC,code:5001,stringify:e=>"User disapproved requested json-rpc methods",format:e=>({code:_[f.DISAPPROVED_JSONRPC].code,message:_[f.DISAPPROVED_JSONRPC].stringify(e)})},[f.DISAPPROVED_NOTIFICATION]:{type:f.DISAPPROVED_NOTIFICATION,code:5002,stringify:e=>"User disapproved requested notification types",format:e=>({code:_[f.DISAPPROVED_NOTIFICATION].code,message:_[f.DISAPPROVED_NOTIFICATION].stringify(e)})},[f.UNSUPPORTED_CHAINS]:{type:f.UNSUPPORTED_CHAINS,code:5100,stringify:e=>"Requested chains are not supported: "+(null==e?void 0:e.chains.toString()),format:e=>({code:_[f.UNSUPPORTED_CHAINS].code,message:_[f.UNSUPPORTED_CHAINS].stringify(e)})},[f.UNSUPPORTED_JSONRPC]:{type:f.UNSUPPORTED_JSONRPC,code:5101,stringify:e=>"Requested json-rpc methods are not supported: "+(null==e?void 0:e.methods.toString()),format:e=>({code:_[f.UNSUPPORTED_JSONRPC].code,message:_[f.UNSUPPORTED_JSONRPC].stringify(e)})},[f.UNSUPPORTED_NOTIFICATION]:{type:f.UNSUPPORTED_NOTIFICATION,code:5102,stringify:e=>"Requested notification types are not supported: "+(null==e?void 0:e.types.toString()),format:e=>({code:_[f.UNSUPPORTED_NOTIFICATION].code,message:_[f.UNSUPPORTED_NOTIFICATION].stringify(e)})},[f.UNSUPPORTED_SIGNAL]:{type:f.UNSUPPORTED_SIGNAL,code:5103,stringify:e=>`Proposed ${(null==e?void 0:e.context)||E} signal is unsupported`,format:e=>({code:_[f.UNSUPPORTED_SIGNAL].code,message:_[f.UNSUPPORTED_SIGNAL].stringify(e)})},[f.USER_DISCONNECTED]:{type:f.USER_DISCONNECTED,code:5900,stringify:e=>"User disconnected "+((null==e?void 0:e.context)||E),format:e=>({code:_[f.USER_DISCONNECTED].code,message:_[f.USER_DISCONNECTED].stringify(e)})},[f.UNKNOWN]:{type:f.UNKNOWN,code:9e3,stringify:e=>"Unknown error"+(e?": "+(null==e?void 0:e.toString()):""),format:e=>({code:_[f.UNKNOWN].code,message:_[f.UNKNOWN].stringify(e)})}};var v=r(85);const R="waku";function m(e){return(null==e?void 0:e.relay)||{protocol:R}}function S(e){const t=v.RELAY_JSONRPC[e];if(void 0===t)throw new Error("Relay Protocol not supported: "+e);return t}var T=r(23),O=r(19);function b(e){return`${e.protocol}:${e.topic}@${e.version}?`+T.stringify({publicKey:e.publicKey,controller:e.controller,relay:Object(O.safeJsonStringify)(e.relay)})}function N(e){const t=e.indexOf(":"),r=-1!==e.indexOf("?")?e.indexOf("?"):void 0,n=e.substring(0,t),i=e.substring(t+1,r).split("@"),o=void 0!==r?e.substr(r):"",s=T.parse(o);return{protocol:n,topic:i[0],version:parseInt(i[1],10),publicKey:s.publicKey,controller:"true"===s.controller,relay:Object(O.safeJsonParse)(s.relay)}}function I(e){return"pairing"===e.method}function w(e){return"uri"===e.method}function A(e){return"responded"===e}function P(e){return A(e.status)&&"outcome"in e}function C(e){return"reason"in e}function L(e){return"reason"in e}function U(e){return"responded"===e}function D(e){return U(e.status)&&"outcome"in e}function x(e){return"reason"in e}function M(e){return"reason"in e}function q(e){return"responded"===e}function j(e){return U(e.status)&&"outcome"in e}function H(e){return"reason"in e}function V(e){return"reason"in e}function B(e){return"update"in e}function K(e){const t=J(e.blockchain);if(te(t))return t;const r=F(e.jsonrpc);if(te(r))return r;const n=z(e.notifications);return te(n)?n:{valid:!0}}function G(e){return Q(e.name)?Q(e.description)?void 0!==e.url&&ee(e.url)?void 0!==e.icons&&X(e.icons,ee)?{valid:!0}:ne(_.MISSING_OR_INVALID.format({name:"metadata icons"})):ne(_.MISSING_OR_INVALID.format({name:"metadata url"})):ne(_.MISSING_OR_INVALID.format({name:"metadata description"})):ne(_.MISSING_OR_INVALID.format({name:"metadata name"}))}function k(e){const t=K(e.permissions);if(te(t))return t;const r=G(e.metadata);return te(r)?r:{valid:!0}}function Y(e){if(e.approved){if(void 0===e.response)return ne(_.MISSING_RESPONSE.format({context:"session"}));const t=W(e.response.state,e.proposal.permissions.blockchain);if(te(t))return t;const r=G(e.response.metadata);if(te(r))return r}return{valid:!0}}function J(e){return void 0!==e&&void 0!==e.chains&&X(e.chains,$)?{valid:!0}:ne(_.MISSING_OR_INVALID.format({name:"blockchain permissions"}))}function F(e){return void 0!==e&&void 0!==e.methods&&X(e.methods,Q)?{valid:!0}:ne(_.MISSING_OR_INVALID.format({name:"jsonrpc permissions"}))}function z(e){return void 0!==e&&void 0!==e.types&&X(e.types,Q)?{valid:!0}:ne(_.MISSING_OR_INVALID.format({name:"notification permissions"}))}function W(e,t){if(void 0===t||void 0===t.chains||!X(t.chains,$))return ne(_.MISSING_OR_INVALID.format({name:"blockchain permissions"}));if(void 0===e||void 0===e.accounts||!X(e.accounts,Z))return ne(_.MISSING_OR_INVALID.format({name:"state accounts"}));const r=e.accounts.filter(e=>{const[r,n]=e.split(":"),i=`${r}:${n}`;return!t.chains.includes(i)});return r.length?ne(_.MISMATCHED_ACCOUNTS.format({mismatched:r})):{valid:!0}}function X(e,t){if(Array.isArray(e)){if(void 0!==t&&e.length){return e.filter(t).length===e.length}return!0}return!1}function Q(e){return"string"==typeof e&&!!e.trim()}function $(e){if(Q(e)&&e.includes(":")){return 2===e.split(":").length}return!1}function Z(e){if(Q(e)&&e.includes(":")){const t=e.split(":");if(3===t.length){const e=t[0]+":"+t[1];return!!t[2]&&$(e)}}return!1}function ee(e){if(Q(e))try{return void 0!==new URL(e)}catch(e){return!1}return!1}function te(e){return"valid"in e&&!1===e.valid&&"error"in e&&"number"==typeof e.error.code&&"string"==typeof e.error.message}function re(){return{valid:!0}}function ne(e){return{valid:!1,error:e}}},function(e,t,r){"use strict";(function(e){r.d(t,"f",(function(){return c})),r.d(t,"d",(function(){return u})),r.d(t,"c",(function(){return d})),r.d(t,"a",(function(){return l})),r.d(t,"g",(function(){return f})),r.d(t,"b",(function(){return h})),r.d(t,"e",(function(){return p})),r.d(t,"x",(function(){return g})),r.d(t,"y",(function(){return E})),r.d(t,"w",(function(){return y})),r.d(t,"s",(function(){return _})),r.d(t,"h",(function(){return v})),r.d(t,"r",(function(){return R})),r.d(t,"u",(function(){return m})),r.d(t,"o",(function(){return S})),r.d(t,"i",(function(){return T})),r.d(t,"D",(function(){return O})),r.d(t,"n",(function(){return b})),r.d(t,"p",(function(){return N})),r.d(t,"v",(function(){return I})),r.d(t,"t",(function(){return w})),r.d(t,"B",(function(){return A})),r.d(t,"A",(function(){return P})),r.d(t,"C",(function(){return C})),r.d(t,"z",(function(){return L})),r.d(t,"m",(function(){return U})),r.d(t,"l",(function(){return D})),r.d(t,"k",(function(){return x})),r.d(t,"E",(function(){return M})),r.d(t,"q",(function(){return q})),r.d(t,"j",(function(){return j}));var n=r(83),i=r.n(n),o=r(23),s=r(84),a=r(24);const c="ReactNative",u={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},d=" ",l=":",f="/",h=2,p=1e3;function g(){return void 0!==e&&void 0!==e.versions&&void 0!==e.versions.node}function E(){return!Object(a.getDocument)()&&!!Object(a.getNavigator)()&&navigator.product===c}function y(){return!g()&&!!Object(a.getNavigator)()}function _(){return E()?u.reactNative:g()?u.node:y()?u.browser:u.unknown}function v(e,t){let r=o.parse(e);return r=Object.assign(Object.assign({},r),t),e=o.stringify(r)}function R(){return Object(s.getWindowMetadata)()||void 0}function m(e,t){var r;const n=_(),i={protocol:e,version:t,env:n};return"browser"===n&&(i.host=(null===(r=Object(a.getLocation)())||void 0===r?void 0:r.host)||""),i}function S(e,t,r,n){const i=r.split("?"),o=m(e,t),s=n?Object.assign(Object.assign({},o),{projectId:n}):o,a=v(i[1]||"",s);return i[0]+"?"+a}function T(e,t,r){if(!e[t]||typeof e[t]!==r)throw new Error(`Missing or invalid "${t}" param`)}function O(e,t=h){return w(e.split(f),t)}function b(e){return O(e).join(d)}function N(e){return O(e).join(l)}function I(e,t){return e.filter(e=>t.includes(e)).length===e.length}function w(e,t=h){return e.slice(Math.max(e.length-t,0))}function A(e,t){return i()(e,t)}function P(e){return Object.fromEntries(e.entries())}function C(e){return new Map(Object.entries(e))}function L(e,t){const r={};return Object.keys(e).forEach(n=>{r[n]=t(e[n])}),r}const U=e=>e;function D(e){return e.trim().replace(/^\w/,e=>e.toUpperCase())}function x(e){return e.split(d).map(e=>D(e)).join(d)}function M(e){return e*p}function q(e){return Math.floor(e/p)}function j(e,t){return q((t||Date.now())+M(e))}}).call(this,r(58))},function(e,t,r){"use strict";r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return a})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return l}));var n=r(6),i=r(0);async function o(e,t=i.a){return n.getSubtleCrypto().importKey("raw",e,function(e){return e===i.a?{length:i.b,name:i.a}:{hash:{name:i.g},name:i.f}}(t),!0,function(e){return e===i.a?[i.d,i.c]:[i.p,i.q]}(t))}async function s(e,t,r){const s=n.getSubtleCrypto(),a=await o(t,i.a),c=await s.encrypt({iv:e,name:i.a},a,r);return new Uint8Array(c)}async function a(e,t,r){const s=n.getSubtleCrypto(),a=await o(t,i.a),c=await s.decrypt({iv:e,name:i.a},a,r);return new Uint8Array(c)}async function c(e,t){const r=n.getSubtleCrypto(),s=await o(e,i.f),a=await r.sign({length:i.h,name:i.f},s,t);return new Uint8Array(a)}async function u(e,t){const r=n.getSubtleCrypto(),s=await o(e,i.f),a=await r.sign({length:i.l,name:i.f},s,t);return new Uint8Array(a)}async function d(e){const t=n.getSubtleCrypto(),r=await t.digest({name:i.n},e);return new Uint8Array(r)}async function l(e){const t=n.getSubtleCrypto(),r=await t.digest({name:i.o},e);return new Uint8Array(r)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"f",(function(){return c})),r.d(t,"g",(function(){return u})),r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return l})),r.d(t,"h",(function(){return f})),r.d(t,"b",(function(){return h}));var n=r(35),i=r(1),o=r(3);function s(e,t){return n.sharedKey(e,t)}function a(e){const t=void 0!==e?function(e){return{isAvailable:!0,randomBytes:()=>e}}(e):void 0,r=n.generateKeyPair(t);return{publicKey:r.publicKey,privateKey:r.secretKey}}function c(e){const t=(null==e?void 0:e.sender)||a();return{privateKey:t.privateKey,publicKey:t.publicKey}}function u(e,t){return s(e,t)}function d(e){return new Uint8Array(e.slice(o.LENGTH_0,o.KEY_LENGTH))}function l(e){return new Uint8Array(e.slice(o.KEY_LENGTH))}function f(e){return Object(i.concatArrays)(e.iv,e.publicKey,e.mac,e.ciphertext)}function h(e){const t=o.LENGTH_0,r=t+o.IV_LENGTH,n=r+o.KEY_LENGTH,i=n+o.MAC_LENGTH,s=e.length;return{iv:e.slice(t,r),publicKey:e.slice(r,n),mac:e.slice(n,i),ciphertext:e.slice(i,s)}}},function(e,t,r){"use strict";r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return o})),r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"g",(function(){return c})),r.d(t,"h",(function(){return u})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return l}));var n=r(7);function i(e){return Object(n.c)(e,"subscribe")}function o(e){return Object(n.b)(e,["topic"],[])}function s(e){return Object(n.c)(e,"publish")}function a(e){return Object(n.b)(e,["message","topic","ttl"],["prompt"])}function c(e){return Object(n.c)(e,"unsubscribe")}function u(e){return Object(n.b)(e,["id","topic"],[])}function d(e){return Object(n.c)(e,"subscription")}function l(e){return Object(n.b)(e,["id","data"],[])}},function(e,t,r){"use strict";r.r(t);var n=r(38);r.d(t,"IClient",(function(){return n.a}));var i=r(42);r.d(t,"IKeyChain",(function(){return i.b})),r.d(t,"ICrypto",(function(){return i.a}));var o=r(43);r.d(t,"IEncoder",(function(){return o.a}));var s=r(44);r.d(t,"IEngine",(function(){return s.a}));var a=r(45);r.d(t,"IExpirer",(function(){return a.a}));var c=r(46);r.d(t,"IHeartBeat",(function(){return c.a}));var u=r(47);r.d(t,"IJsonRpcHistory",(function(){return u.a}));var d=r(48);for(var l in d)["default","IClient","IKeyChain","ICrypto","IEncoder","IEngine","IExpirer","IHeartBeat","IJsonRpcHistory"].indexOf(l)<0&&function(e){r.d(t,e,(function(){return d[e]}))}(l);var f=r(49);for(var l in f)["default","IClient","IKeyChain","ICrypto","IEncoder","IEngine","IExpirer","IHeartBeat","IJsonRpcHistory"].indexOf(l)<0&&function(e){r.d(t,e,(function(){return f[e]}))}(l);var h=r(50);r.d(t,"IPairing",(function(){return h.a}));var p=r(51);r.d(t,"IPublisher",(function(){return p.a}));var g=r(52);r.d(t,"IRelayerEncoder",(function(){return g.b})),r.d(t,"IRelayer",(function(){return g.a}));var E=r(22);r.d(t,"ISequence",(function(){return E.a}));var y=r(53);r.d(t,"ISession",(function(){return y.a}));var _=r(54);r.d(t,"IStore",(function(){return _.a}));var v=r(55);r.d(t,"IBaseStorage",(function(){return v.a})),r.d(t,"IRelayerStorage",(function(){return v.b})),r.d(t,"IStorage",(function(){return v.c}));var R=r(56);r.d(t,"ISubscriberTopicMap",(function(){return R.b})),r.d(t,"ISubscriber",(function(){return R.a}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_SECOND=t.FIVE_SECONDS=t.TEN_SECONDS=t.THIRTY_SECONDS=t.FIVE_MINUTES=t.SIX_HOURS=t.ONE_DAY=t.SEVEN_DAYS=t.THREE_WEEKS=t.THIRTY_DAYS=void 0,t.THIRTY_DAYS=2592e3,t.THREE_WEEKS=1814400,t.SEVEN_DAYS=604800,t.ONE_DAY=86400,t.SIX_HOURS=21600,t.FIVE_MINUTES=300,t.THIRTY_SECONDS=30,t.TEN_SECONDS=10,t.FIVE_SECONDS=5,t.ONE_SECOND=1},function(e,t,r){"use strict";function n(e){if("string"!=typeof e)throw new Error("Cannot safe json parse value of type "+typeof e);try{return JSON.parse(e)}catch(t){return e}}function i(e){return"string"==typeof e?e:JSON.stringify(e)}r.r(t),r.d(t,"safeJsonParse",(function(){return n})),r.d(t,"safeJsonStringify",(function(){return i}))},function(e,t,r){"use strict";r.d(t,"d",(function(){return i})),r.d(t,"c",(function(){return o})),r.d(t,"e",(function(){return s})),r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return c})),r.d(t,"g",(function(){return u})),r.d(t,"f",(function(){return d}));var n=r(4);function i(e){return e<=n.h[0]&&e>=n.h[1]}function o(e){return n.f.includes(e)}function s(e){return"number"==typeof e}function a(e){return Object.keys(n.i).includes(e)?n.i[e]:n.i[n.a]}function c(e){const t=Object.values(n.i).find(t=>t.code===e);return t||n.i[n.a]}function u(e){if(void 0===e.error.code)return{valid:!1,error:"Missing code for JSON-RPC error"};if(void 0===e.error.message)return{valid:!1,error:"Missing message for JSON-RPC error"};if(!s(e.error.code))return{valid:!1,error:"Invalid error code type for JSON-RPC: "+e.error.code};if(o(e.error.code)){const t=c(e.error.code);if(t.message!==n.i[n.a].message&&e.error.message===t.message)return{valid:!1,error:"Invalid error code message for JSON-RPC: "+e.error.code}}return{valid:!0}}function d(e,t,r){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):e}},function(e,t,r){"use strict";var n=r(3);r.o(n,"decryptWithSharedKey")&&r.d(t,"decryptWithSharedKey",(function(){return n.decryptWithSharedKey})),r.o(n,"derive")&&r.d(t,"derive",(function(){return n.derive})),r.o(n,"encryptWithSharedKey")&&r.d(t,"encryptWithSharedKey",(function(){return n.encryptWithSharedKey})),r.o(n,"generateKeyPair")&&r.d(t,"generateKeyPair",(function(){return n.generateKeyPair})),r.o(n,"randomBytes")&&r.d(t,"randomBytes",(function(){return n.randomBytes})),r.o(n,"sha256")&&r.d(t,"sha256",(function(){return n.sha256}));var i=r(66);r.d(t,"decryptWithSharedKey",(function(){return i.a})),r.d(t,"encryptWithSharedKey",(function(){return i.b}));var o=r(15);r.d(t,"derive",(function(){return o.a})),r.d(t,"generateKeyPair",(function(){return o.c}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(2);class i extends n.IEvents{constructor(e,t){super(),this.client=e,this.logger=t}}},function(e,t,r){"use strict";const n=r(107),i=r(108),o=r(109),s=r(110);function a(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function c(e,t){return t.encode?t.strict?n(e):encodeURIComponent(e):e}function u(e,t){return t.decode?i(e):e}function d(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function l(e){const t=(e=d(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function f(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function h(e,t){a((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,n)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===n[e]&&(n[e]={}),n[e][t[1]]=r):n[e]=r};case"bracket":return(e,r,n)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],r):n[e]=[r]:n[e]=r};case"comma":case"separator":return(t,r,n)=>{const i="string"==typeof r&&r.includes(e.arrayFormatSeparator),o="string"==typeof r&&!i&&u(r,e).includes(e.arrayFormatSeparator);r=o?u(r,e):r;const s=i||o?r.split(e.arrayFormatSeparator).map(t=>u(t,e)):null===r?r:u(r,e);n[t]=s};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[].concat(r[e],t):r[e]=t}}}(t),n=Object.create(null);if("string"!=typeof e)return n;if(!(e=e.trim().replace(/^[?#&]/,"")))return n;for(const i of e.split("&")){if(""===i)continue;let[e,s]=o(t.decode?i.replace(/\+/g," "):i,"=");s=void 0===s?null:["comma","separator"].includes(t.arrayFormat)?s:u(s,t),r(u(e,t),s,n)}for(const e of Object.keys(n)){const r=n[e];if("object"==typeof r&&null!==r)for(const e of Object.keys(r))r[e]=f(r[e],t);else n[e]=f(r,t)}return!1===t.sort?n:(!0===t.sort?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce((e,t)=>{const r=n[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(r):e[t]=r,e},Object.create(null))}t.extract=l,t.parse=h,t.stringify=(e,t)=>{if(!e)return"";a((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const r=r=>t.skipNull&&null==e[r]||t.skipEmptyString&&""===e[r],n=function(e){switch(e.arrayFormat){case"index":return t=>(r,n)=>{const i=r.length;return void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[c(t,e),"[",i,"]"].join("")]:[...r,[c(t,e),"[",c(i,e),"]=",c(n,e)].join("")]};case"bracket":return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[c(t,e),"[]"].join("")]:[...r,[c(t,e),"[]=",c(n,e)].join("")];case"comma":case"separator":return t=>(r,n)=>null==n||0===n.length?r:0===r.length?[[c(t,e),"=",c(n,e)].join("")]:[[r,c(n,e)].join(e.arrayFormatSeparator)];default:return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,c(t,e)]:[...r,[c(t,e),"=",c(n,e)].join("")]}}(t),i={};for(const t of Object.keys(e))r(t)||(i[t]=e[t]);const o=Object.keys(i);return!1!==t.sort&&o.sort(t.sort),o.map(r=>{const i=e[r];return void 0===i?"":null===i?c(r,t):Array.isArray(i)?i.reduce(n(r),[]).join("&"):c(r,t)+"="+c(i,t)}).filter(e=>e.length>0).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[r,n]=o(e,"#");return Object.assign({url:r.split("?")[0]||"",query:h(l(e),t)},t&&t.parseFragmentIdentifier&&n?{fragmentIdentifier:u(n,t)}:{})},t.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0},r);const n=d(e.url).split("?")[0]||"",i=t.extract(e.url),o=t.parse(i,{sort:!1}),s=Object.assign(o,e.query);let a=t.stringify(s,r);a&&(a="?"+a);let u=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);return e.fragmentIdentifier&&(u="#"+c(e.fragmentIdentifier,r)),`${n}${a}${u}`},t.pick=(e,r,n)=>{n=Object.assign({parseFragmentIdentifier:!0},n);const{url:i,query:o,fragmentIdentifier:a}=t.parseUrl(e,n);return t.stringifyUrl({url:i,query:s(o,r),fragmentIdentifier:a},n)},t.exclude=(e,r,n)=>{const i=Array.isArray(r)?e=>!r.includes(e):(e,t)=>!r(e,t);return t.pick(e,i,n)}},function(e,t,r){"use strict";function n(e){let t=void 0;return"undefined"!=typeof window&&void 0!==window[e]&&(t=window[e]),t}function i(e){const t=n(e);if(!t)throw new Error(e+" is not defined in Window");return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalStorage=t.getLocalStorageOrThrow=t.getCrypto=t.getCryptoOrThrow=t.getLocation=t.getLocationOrThrow=t.getNavigator=t.getNavigatorOrThrow=t.getDocument=t.getDocumentOrThrow=t.getFromWindowOrThrow=t.getFromWindow=void 0,t.getFromWindow=n,t.getFromWindowOrThrow=i,t.getDocumentOrThrow=function(){return i("document")},t.getDocument=function(){return n("document")},t.getNavigatorOrThrow=function(){return i("navigator")},t.getNavigator=function(){return n("navigator")},t.getLocationOrThrow=function(){return i("location")},t.getLocation=function(){return n("location")},t.getCryptoOrThrow=function(){return i("crypto")},t.getCrypto=function(){return n("crypto")},t.getLocalStorageOrThrow=function(){return i("localStorage")},t.getLocalStorage=function(){return n("localStorage")}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));class n{}},function(e,t,r){"use strict";var n=r(61);r.o(n,"ERROR_BAD_MAC")&&r.d(t,"ERROR_BAD_MAC",(function(){return n.ERROR_BAD_MAC})),r.o(n,"IV_LENGTH")&&r.d(t,"IV_LENGTH",(function(){return n.IV_LENGTH})),r.o(n,"KEY_LENGTH")&&r.d(t,"KEY_LENGTH",(function(){return n.KEY_LENGTH})),r.o(n,"LENGTH_0")&&r.d(t,"LENGTH_0",(function(){return n.LENGTH_0})),r.o(n,"MAC_LENGTH")&&r.d(t,"MAC_LENGTH",(function(){return n.MAC_LENGTH})),r.o(n,"assert")&&r.d(t,"assert",(function(){return n.assert})),r.o(n,"decryptWithSharedKey")&&r.d(t,"decryptWithSharedKey",(function(){return n.decryptWithSharedKey})),r.o(n,"derive")&&r.d(t,"derive",(function(){return n.derive})),r.o(n,"encryptWithSharedKey")&&r.d(t,"encryptWithSharedKey",(function(){return n.encryptWithSharedKey})),r.o(n,"generateKeyPair")&&r.d(t,"generateKeyPair",(function(){return n.generateKeyPair})),r.o(n,"isConstantTime")&&r.d(t,"isConstantTime",(function(){return n.isConstantTime}));r(62);var i=r(63);r.o(i,"ERROR_BAD_MAC")&&r.d(t,"ERROR_BAD_MAC",(function(){return i.ERROR_BAD_MAC})),r.o(i,"IV_LENGTH")&&r.d(t,"IV_LENGTH",(function(){return i.IV_LENGTH})),r.o(i,"KEY_LENGTH")&&r.d(t,"KEY_LENGTH",(function(){return i.KEY_LENGTH})),r.o(i,"LENGTH_0")&&r.d(t,"LENGTH_0",(function(){return i.LENGTH_0})),r.o(i,"MAC_LENGTH")&&r.d(t,"MAC_LENGTH",(function(){return i.MAC_LENGTH})),r.o(i,"assert")&&r.d(t,"assert",(function(){return i.assert})),r.o(i,"decryptWithSharedKey")&&r.d(t,"decryptWithSharedKey",(function(){return i.decryptWithSharedKey})),r.o(i,"derive")&&r.d(t,"derive",(function(){return i.derive})),r.o(i,"encryptWithSharedKey")&&r.d(t,"encryptWithSharedKey",(function(){return i.encryptWithSharedKey})),r.o(i,"generateKeyPair")&&r.d(t,"generateKeyPair",(function(){return i.generateKeyPair})),r.o(i,"isConstantTime")&&r.d(t,"isConstantTime",(function(){return i.isConstantTime}));var o=r(64);r.d(t,"assert",(function(){return o.a})),r.d(t,"isConstantTime",(function(){return o.b}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonRpcHistory=void 0;const n=r(5),i=r(10),o=r(17),s=r(12),a=r(8),c=r(11),u=r(9);class d extends o.IJsonRpcHistory{constructor(e,t){super(e,t),this.logger=e,this.storage=t,this.records=new Map,this.events=new i.EventEmitter,this.name=u.HISTORY_CONTEXT,this.cached=[],this.logger=c.generateChildLogger(e,this.name),this.storage=t,this.registerEventListeners()}init(){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}get context(){return c.getLoggerContext(this.logger)}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(void 0!==t.response)return;const r={topic:t.topic,request:a.formatJsonRpcRequest(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}set(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:r}),this.records.has(t.id))return;const n={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:r};this.records.set(n.id,n),this.events.emit(u.HISTORY_EVENTS.created,n)}))}resolve(e){return n.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;const t=yield this.getRecord(e.id);void 0===t.response&&(t.response=a.isJsonRpcError(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.events.emit(u.HISTORY_EVENTS.updated,t))}))}get(e,t){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t});const r=yield this.getRecord(t);if(r.topic!==e){const e=s.ERROR.MISMATCHED_TOPIC.format({context:s.formatMessageContext(this.context),id:t});throw new Error(e.message)}return r}))}delete(e,t){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach(r=>{if(r.topic===e){if(void 0!==t&&r.id!==t)return;this.records.delete(r.id),this.events.emit(u.HISTORY_EVENTS.deleted,r)}})}))}exists(e,t){return n.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),!this.records.has(t))return!1;return(yield this.getRecord(t)).topic===e}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}getRecord(e){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized();const t=this.records.get(e);if(!t){const t=s.ERROR.NO_MATCHING_ID.format({context:s.formatMessageContext(this.context),id:e});throw new Error(t.message)}return t}))}persist(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.storage.setJsonRpcRecords(this.context,this.values),this.events.emit(u.HISTORY_EVENTS.sync)}))}restore(){return n.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.storage.getJsonRpcRecords(this.context);if(void 0===e)return;if(!e.length)return;if(this.records.size){const e=s.ERROR.RESTORE_WILL_OVERRIDE.format({context:s.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,this.logger.debug("Successfully Restored records for "+s.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug("Failed to Restore records for "+s.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),this.reset(),this.onInit()}))}reset(){this.cached.forEach(e=>this.records.set(e.id,e))}onInit(){this.cached=[],this.events.emit(u.HISTORY_EVENTS.init)}isInitialized(){return n.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(u.HISTORY_EVENTS.init,()=>e())})}))}registerEventListeners(){this.events.on(u.HISTORY_EVENTS.created,e=>{const t=u.HISTORY_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(u.HISTORY_EVENTS.updated,e=>{const t=u.HISTORY_EVENTS.updated;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(u.HISTORY_EVENTS.deleted,e=>{const t=u.HISTORY_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}}t.JsonRpcHistory=d},function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return a}));var n=r(10),i=r(19),o=r(8);const s=void 0!==e.WebSocket?e.WebSocket:r(130);class a{constructor(e){if(this.url=e,this.events=new n.EventEmitter,this.registering=!1,!Object(o.isWsUrl)(e))throw new Error("Provided URL is not compatible with WebSocket connection: "+e);this.url=e}get connected(){return void 0!==this.socket}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(void 0===this.socket)throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,t){void 0===this.socket&&(this.socket=await this.register());try{this.socket.send(Object(i.safeJsonStringify)(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Object(o.isWsUrl)(e))throw new Error("Provided URL is not compatible with WebSocket connection: "+e);return this.registering?new Promise((e,t)=>{this.events.once("register_error",e=>{t(e)}),this.events.once("open",()=>{if(void 0===this.socket)return t(new Error("WebSocket connection is missing or invalid"));e(this.socket)})}):(this.url=e,this.registering=!0,new Promise((t,r)=>{const n=Object(o.isReactNative)()?void 0:{rejectUnauthorized:!Object(o.isLocalhostUrl)(e)},i=new s(e,[],n);i.onopen=()=>{this.onOpen(i),t(i)},i.onerror=e=>{const t=this.parseError(e.error);this.events.emit("register_error",t),this.onClose(),r(t)}}))}onOpen(e){e.onmessage=e=>this.onPayload(e),e.onclose=()=>this.onClose(),e.onerror=e=>{const t=this.parseError(e.error);this.events.emit("error",t)},this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(void 0===e.data)return;const t="string"==typeof e.data?Object(i.safeJsonParse)(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const r=this.parseError(t),n=r.message||r.toString(),i=Object(o.formatJsonRpcError)(e,n);this.events.emit("payload",i)}parseError(e,t=this.url){return Object(o.parseConnectionError)(e,t,"WS")}}t.b=a}).call(this,r(25))},function(e,t,r){"use strict";const n=r(88);e.exports=s;const i=function(){function e(e){return void 0!==e&&e}try{return"undefined"!=typeof globalThis||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(t){return e(self)||e(window)||e(this)||{}}}().console||{},o={mapHttpRequest:p,mapHttpResponse:p,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:p,res:p,err:function(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const r in e)void 0===t[r]&&(t[r]=e[r]);return t}};function s(e){(e=e||{}).browser=e.browser||{};const t=e.browser.transmit;if(t&&"function"!=typeof t.send)throw Error("pino: transmit option must have a send function");const r=e.browser.write||i;e.browser.write&&(e.browser.asObject=!0);const n=e.serializers||{},o=function(e,t){if(Array.isArray(e)){return e.filter((function(e){return"!stdSerializers.err"!==e}))}return!0===e&&Object.keys(t)}(e.browser.serialize,n);let c=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);"function"==typeof r&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),!1===e.enabled&&(e.level="silent");const l=e.level||"info",p=Object.create(r);p.log||(p.log=E),Object.defineProperty(p,"levelVal",{get:function(){return"silent"===this.level?1/0:this.levels.values[this.level]}}),Object.defineProperty(p,"level",{get:function(){return this._level},set:function(e){if("silent"!==e&&!this.levels.values[e])throw Error("unknown level "+e);this._level=e,a(g,p,"error","log"),a(g,p,"fatal","error"),a(g,p,"warn","error"),a(g,p,"info","log"),a(g,p,"debug","log"),a(g,p,"trace","log")}});const g={transmit:t,serialize:o,asObject:e.browser.asObject,levels:["error","fatal","warn","info","debug","trace"],timestamp:h(e)};return p.levels=s.levels,p.level=l,p.setMaxListeners=p.getMaxListeners=p.emit=p.addListener=p.on=p.prependListener=p.once=p.prependOnceListener=p.removeListener=p.removeAllListeners=p.listeners=p.listenerCount=p.eventNames=p.write=p.flush=E,p.serializers=n,p._serialize=o,p._stdErrSerialize=c,p.child=function(r,i){if(!r)throw new Error("missing bindings for child Pino");i=i||{},o&&r.serializers&&(i.serializers=r.serializers);const s=i.serializers;if(o&&s){var a=Object.assign({},n,s),c=!0===e.browser.serialize?Object.keys(a):o;delete r.serializers,u([r],c,a,this._stdErrSerialize)}function l(e){this._childLevel=1+(0|e._childLevel),this.error=d(e,r,"error"),this.fatal=d(e,r,"fatal"),this.warn=d(e,r,"warn"),this.info=d(e,r,"info"),this.debug=d(e,r,"debug"),this.trace=d(e,r,"trace"),a&&(this.serializers=a,this._serialize=c),t&&(this._logEvent=f([].concat(e._logEvent.bindings,r)))}return l.prototype=this,new l(this)},t&&(p._logEvent=f()),p}function a(e,t,r,n){const o=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?E:o[r]?o[r]:i[r]||i[n]||E,function(e,t,r){if(!e.transmit&&t[r]===E)return;t[r]=(n=t[r],function(){const o=e.timestamp(),a=new Array(arguments.length),d=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var f=0;f<a.length;f++)a[f]=arguments[f];if(e.serialize&&!e.asObject&&u(a,this._serialize,this.serializers,this._stdErrSerialize),e.asObject?n.call(d,c(this,r,a,o)):n.apply(d,a),e.transmit){const n=e.transmit.level||t.level,i=s.levels.values[n],c=s.levels.values[r];if(c<i)return;l(this,{ts:o,methodLevel:r,methodValue:c,transmitLevel:n,transmitValue:s.levels.values[e.transmit.level||t.level],send:e.transmit.send,val:t.levelVal},a)}});var n}(e,t,r)}function c(e,t,r,i){e._serialize&&u(r,e._serialize,e.serializers,e._stdErrSerialize);const o=r.slice();let a=o[0];const c={};i&&(c.time=i),c.level=s.levels.values[t];let d=1+(0|e._childLevel);if(d<1&&(d=1),null!==a&&"object"==typeof a){for(;d--&&"object"==typeof o[0];)Object.assign(c,o.shift());a=o.length?n(o.shift(),o):void 0}else"string"==typeof a&&(a=n(o.shift(),o));return void 0!==a&&(c.msg=a),c}function u(e,t,r,n){for(const i in e)if(n&&e[i]instanceof Error)e[i]=s.stdSerializers.err(e[i]);else if("object"==typeof e[i]&&!Array.isArray(e[i]))for(const n in e[i])t&&t.indexOf(n)>-1&&n in r&&(e[i][n]=r[n](e[i][n]))}function d(e,t,r){return function(){const n=new Array(1+arguments.length);n[0]=t;for(var i=1;i<n.length;i++)n[i]=arguments[i-1];return e[r].apply(this,n)}}function l(e,t,r){const n=t.send,i=t.ts,o=t.methodLevel,s=t.methodValue,a=t.val,c=e._logEvent.bindings;u(r,e._serialize||Object.keys(e.serializers),e.serializers,void 0===e._stdErrSerialize||e._stdErrSerialize),e._logEvent.ts=i,e._logEvent.messages=r.filter((function(e){return-1===c.indexOf(e)})),e._logEvent.level.label=o,e._logEvent.level.value=s,n(o,e._logEvent,a),e._logEvent=f(c)}function f(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function h(e){return"function"==typeof e.timestamp?e.timestamp:!1===e.timestamp?y:_}function p(){return{}}function g(e){return e}function E(){}function y(){return!1}function _(){return Date.now()}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=o,s.stdTimeFunctions=Object.assign({},{nullTime:y,epochTime:_,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wipe=function(e){for(var t=0;t<e.length;t++)e[t]=0;return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;const n=r(5),i=r(17),o=r(12),s=r(8),a=r(9);class c extends i.IEngine{constructor(e){super(e),this.sequence=e,this.registerEventListeners()}find(e){return n.__awaiter(this,void 0,void 0,(function*(){return this.sequence.values.filter(t=>{var r,n,i,s,a,c;let u=!1;return(null===(r=t.permissions)||void 0===r?void 0:r.jsonrpc)&&(null===(n=e.jsonrpc)||void 0===n?void 0:n.methods)&&o.hasOverlap(e.jsonrpc.methods,t.permissions.jsonrpc.methods)&&(u=!0),(null===(i=t.permissions)||void 0===i?void 0:i.blockchain)&&(null===(s=e.blockchain)||void 0===s?void 0:s.chains)&&o.hasOverlap(e.blockchain.chains,t.permissions.blockchain.chains)&&(u=!0),(null===(a=t.permissions)||void 0===a?void 0:a.notifications)&&(null===(c=e.notifications)||void 0===c?void 0:c.types)&&o.hasOverlap(e.notifications.types,t.permissions.notifications.types)&&(u=!0),u})}))}ping(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r={method:this.sequence.config.jsonrpc.ping,params:{}};return this.request({topic:e,request:r,timeout:t||o.toMiliseconds(a.THIRTY_SECONDS)})}))}send(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){const n=t,i=yield this.sequence.settled.get(e);if(s.isJsonRpcRequest(t)&&!Object.values(this.sequence.config.jsonrpc).includes(t.method)){yield this.isJsonRpcAuthorized(e,i.self,t),yield this.sequence.validateRequest({topic:e,request:t,chainId:r});const n={chainId:r,request:{method:t.method,params:t.params}};n.chainId||delete n.chainId,t=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.payload,n,t.id)}yield this.sequence.client.relayer.publish(i.topic,t,{relay:i.relay}),(s.isJsonRpcResponse(n)||s.isJsonRpcRequest(n)&&!Object.values(this.sequence.config.jsonrpc).includes(n.method))&&(yield this.recordPayloadEvent({topic:e,payload:n,chainId:r}))}))}get length(){return this.sequence.settled.length}get topics(){return this.sequence.settled.topics}get values(){return this.sequence.settled.values}create(e){return new Promise((t,r)=>n.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Create "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"create",params:e});const i=(null==e?void 0:e.timeout)||o.toMiliseconds(a.FIVE_MINUTES),s=setTimeout(()=>{const e=o.ERROR.SETTLE_TIMEOUT.format({context:this.sequence.name,timeout:i});this.sequence.logger.error(e.message),r(e.message)},i);let c;try{c=yield this.propose(e)}catch(e){return clearTimeout(s),r(e)}this.sequence.pending.on(a.STORE_EVENTS.updated,e=>n.__awaiter(this,void 0,void 0,(function*(){if(c.topic===e.sequence.topic&&o.isSequenceResponded(e.sequence)){const n=e.sequence.outcome;if(clearTimeout(s),o.isSequenceFailed(n)){try{yield this.sequence.pending.delete(c.topic,n.reason)}catch(e){return r(e)}r(new Error(n.reason.message))}else try{const e=yield this.sequence.settled.get(n.topic),r=o.ERROR.SETTLED.format({context:this.sequence.name});yield this.sequence.pending.delete(c.topic,r),t(e)}catch(e){return r(e)}}})))})))}respond(e){return n.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Respond "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"respond",params:e}),yield this.sequence.validateRespond(e);const{approved:t,proposal:r,response:n}=e,{relay:i,ttl:s}=r,a={publicKey:yield this.sequence.client.crypto.generateKeyPair(),metadata:null==n?void 0:n.metadata};if(a.metadata||delete a.metadata,!t){const t=o.ERROR.NOT_APPROVED.format({context:this.sequence.name}),n={reason:(null==e?void 0:e.reason)||t},s={status:this.sequence.config.status.responded,topic:r.topic,relay:i,self:a,proposal:r,outcome:n};return yield this.sequence.pending.set(s.topic,s),s}try{const e={publicKey:a.publicKey,metadata:null==n?void 0:n.metadata};e.metadata||delete e.metadata;const t=o.calcExpiry(r.ttl),c=(null==n?void 0:n.state)||{},u={publicKey:r.proposer.publicKey,metadata:r.proposer.metadata};u.metadata||delete u.metadata;const d=r.proposer.controller?{publicKey:u.publicKey}:{publicKey:a.publicKey},l=Object.assign(Object.assign({},r.permissions),{controller:d}),f={topic:(yield this.settle({relay:i,self:a,peer:u,permissions:l,state:c,ttl:s,expiry:t})).topic,relay:i,state:c,responder:e,expiry:t},h={status:this.sequence.config.status.responded,topic:r.topic,relay:i,self:a,proposal:r,outcome:f};return yield this.sequence.pending.set(h.topic,h),h}catch(e){const t={reason:o.ERROR.GENERIC.format({message:e.message})},n={status:this.sequence.config.status.responded,topic:r.topic,relay:i,self:a,proposal:r,outcome:t};return yield this.sequence.pending.set(n.topic,n),n}}))}update(e){return n.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Update "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"update",params:e});const t=yield this.sequence.settled.get(e.topic),r={publicKey:t.self.publicKey},n=yield this.handleUpdate(e.topic,e,r),i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.update,n);return yield this.send(t.topic,i),t}))}upgrade(e){return n.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Upgrade "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"upgrade",params:e});const t=yield this.sequence.settled.get(e.topic),r={publicKey:t.self.publicKey},n=yield this.handleUpgrade(e.topic,e,r),i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.upgrade,n);return yield this.send(t.topic,i),t}))}request(e){return n.__awaiter(this,void 0,void 0,(function*(){return new Promise((t,r)=>n.__awaiter(this,void 0,void 0,(function*(){try{yield this.sequence.validateRequest(e)}catch(e){return r(e)}const n=s.formatJsonRpcRequest(e.request.method,e.request.params),i=(null==e?void 0:e.timeout)||o.toMiliseconds(a.FIVE_MINUTES),c=setTimeout(()=>{const e=o.ERROR.JSONRPC_REQUEST_TIMEOUT.format({method:n.method,timeout:i});this.sequence.logger.error(e.message),r(e.message)},i);this.sequence.events.on(this.sequence.config.events.response,i=>{if(e.topic!==i.topic)return;const o=i.response;if(o.id===n.id){if(clearTimeout(c),s.isJsonRpcError(o)){const e=o.error.message;return this.sequence.logger.error(e),r(new Error(e))}return t(o.result)}});try{yield this.send(e.topic,n,null==e?void 0:e.chainId)}catch(e){return clearTimeout(c),r(e)}})))}))}delete(e){return n.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Delete "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"delete",params:e}),yield this.sequence.settled.delete(e.topic,e.reason)}))}notify(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,notification:r}=e,n=yield this.sequence.settled.get(e.topic);yield this.isNotificationAuthorized(e.topic,n.self,r.type);const i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.notification,r);yield this.send(e.topic,i)}))}propose(e){return n.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Propose "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"propose",params:e}),yield this.sequence.validatePropose(e);const t=(null==e?void 0:e.relay)||{protocol:a.RELAYER_DEFAULT_PROTOCOL},r=o.generateRandomBytes32(),n={publicKey:yield this.sequence.client.crypto.generateKeyPair(),metadata:null==e?void 0:e.metadata};n.metadata||delete n.metadata;const i={publicKey:n.publicKey,controller:this.sequence.client.controller,metadata:n.metadata};i.metadata||delete i.metadata;const s={relay:t,topic:r,proposer:i,signal:(null==e?void 0:e.signal)||(yield this.sequence.getDefaultSignal({topic:r,relay:t,proposer:i})),permissions:(null==e?void 0:e.permissions)||(yield this.sequence.getDefaultPermissions()),ttl:(null==e?void 0:e.ttl)||(yield this.sequence.getDefaultTTL())},c={status:this.sequence.config.status.proposed,topic:s.topic,relay:s.relay,self:n,proposal:s};return yield this.sequence.pending.set(c.topic,c),c}))}settle(e){return n.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Settle "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"settle",params:e});const t={topic:yield this.sequence.client.crypto.generateSharedKey(e.self,e.peer),relay:e.relay,self:e.self,peer:e.peer,permissions:e.permissions,expiry:e.expiry,state:e.state,acknowledged:!1};return yield this.sequence.settled.set(t.topic,t),t}))}onResponse(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} response`),this.sequence.logger.trace({type:"method",method:"onResponse",topic:t,payload:r});const n=r,i=n.params,a=yield this.sequence.pending.get(t);let c,u;if(o.isSequenceRejected(i))this.sequence.logger.error(i.reason),yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:{reason:i.reason}});else{try{const e=a.proposal.proposer.controller?{publicKey:a.proposal.proposer.publicKey}:{publicKey:i.responder.publicKey},r={publicKey:i.responder.publicKey,metadata:i.responder.metadata};r.metadata||delete r.metadata;const n=i.state||{},o=Object.assign(Object.assign({},a.proposal.permissions),{controller:e}),s=yield this.settle({relay:a.relay,self:a.self,peer:r,permissions:o,ttl:a.proposal.ttl,expiry:i.expiry,state:n}),c={topic:s.topic,relay:s.relay,responder:i.responder,expiry:s.expiry,state:s.state};yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:c})}catch(e){this.sequence.logger.error(e),c=o.ERROR.GENERIC.format({message:e.message}),u={reason:c},yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:u})}yield this.sequence.client.relayer.publish(a.topic,void 0===c?s.formatJsonRpcResult(n.id,!0):s.formatJsonRpcError(n.id,c),{relay:a.relay}),void 0===u||o.isSequenceFailed(u)||(yield this.sequence.settled.update(u.topic,{acknowledged:!0}))}}))}onAcknowledge(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} acknowledge`),this.sequence.logger.trace({type:"method",method:"onAcknowledge",topic:t,payload:r});const n=r,i=yield this.sequence.pending.get(t);if(!o.isSequenceResponded(i))return;const{outcome:a}=i;s.isJsonRpcError(n)&&!o.isSequenceFailed(a)&&(yield this.sequence.settled.delete(a.topic,n.error)),void 0===a||o.isSequenceFailed(a)||(yield this.sequence.settled.update(a.topic,{acknowledged:!0}));const c=o.ERROR.RESPONSE_ACKNOWLEDGED.format({context:this.sequence.name});yield this.sequence.pending.delete(t,c)}))}onMessage(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r}=e;if(this.sequence.logger.debug(`Receiving ${this.sequence.context} message`),this.sequence.logger.trace({type:"method",method:"onMessage",topic:t,payload:r}),s.isJsonRpcRequest(r)){const t=r,n=yield this.sequence.settled.get(e.topic);let i;switch(t.method){case this.sequence.config.jsonrpc.payload:yield this.onPayload(e);break;case this.sequence.config.jsonrpc.update:yield this.onUpdate(e);break;case this.sequence.config.jsonrpc.upgrade:yield this.onUpgrade(e);break;case this.sequence.config.jsonrpc.notification:yield this.onNotification(e);break;case this.sequence.config.jsonrpc.delete:yield this.sequence.settled.delete(n.topic,t.params.reason);break;case this.sequence.config.jsonrpc.ping:yield this.send(n.topic,s.formatJsonRpcResult(t.id,!0));break;default:i=o.ERROR.UNKNOWN_JSONRPC_METHOD.format({method:t.method}),this.sequence.logger.error(i.message),yield this.send(n.topic,s.formatJsonRpcError(t.id,i))}}else this.onPayloadEvent(e)}))}onPayload(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r}=e;if(s.isJsonRpcRequest(r)){const{id:e,params:n}=r,{chainId:i}=n,o=s.formatJsonRpcRequest(n.request.method,n.request.params,e),a=yield this.sequence.settled.get(t);yield this.isJsonRpcAuthorized(t,a.peer,o),yield this.sequence.validateRequest({topic:t,request:o,chainId:i});const c={topic:t,payload:o,chainId:i};this.sequence.logger.debug(`Receiving ${this.sequence.context} payload`),this.sequence.logger.trace(Object.assign({type:"method",method:"onPayload"},c)),this.onPayloadEvent(c)}else{const e={topic:t,payload:r};this.sequence.logger.debug(`Receiving ${this.sequence.context} payload`),this.sequence.logger.trace(Object.assign({type:"method",method:"onPayload"},e)),this.onPayloadEvent(e)}}))}onUpdate(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} update`),this.sequence.logger.trace({type:"method",method:"onUpdate",topic:t,payload:r});const n=e.payload,i=yield this.sequence.settled.get(e.topic);try{const e={publicKey:i.peer.publicKey};yield this.handleUpdate(t,n.params,e);const r=s.formatJsonRpcResult(n.id,!0);yield this.send(i.topic,r)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(n.id,e.message);yield this.send(i.topic,t)}}))}onUpgrade(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} upgrade`),this.sequence.logger.trace({type:"method",method:"onUpgrade",topic:t,payload:r});const n=e.payload,i=yield this.sequence.settled.get(e.topic);try{const e={publicKey:i.peer.publicKey};yield this.handleUpgrade(t,n.params,e);const r=s.formatJsonRpcResult(n.id,!0);yield this.send(i.topic,r)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(n.id,e.message);yield this.send(i.topic,t)}}))}onNotification(e){return n.__awaiter(this,void 0,void 0,(function*(){const{params:t}=e.payload,r=e.payload,n=yield this.sequence.settled.get(e.topic);try{yield this.isNotificationAuthorized(e.topic,n.peer,t.type);const i={topic:e.topic,notification:t},o=this.sequence.config.events.notification;this.sequence.logger.info("Emitting "+o),this.sequence.logger.debug({type:"event",event:o,notificationEvent:i}),this.sequence.events.emit(o,i);const a=s.formatJsonRpcResult(r.id,!0);yield this.send(n.topic,a)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(r.id,e.message);yield this.send(n.topic,t)}}))}handleUpdate(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){if(void 0===t.state){const e=o.ERROR.INVALID_UPDATE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const n=yield this.sequence.settled.get(e);if(r.publicKey!==n.permissions.controller.publicKey){const e=o.ERROR.UNAUTHORIZED_UPDATE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const i=yield this.sequence.mergeUpdate(e,t);return yield this.sequence.settled.update(n.topic,{state:i}),t}))}handleUpgrade(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){if(void 0===t.permissions){const e=o.ERROR.INVALID_UPGRADE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const n=yield this.sequence.settled.get(e);if(r.publicKey!==n.permissions.controller.publicKey){const e=o.ERROR.UNAUTHORIZED_UPGRADE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const i=yield this.sequence.mergeUpgrade(e,t);return yield this.sequence.settled.update(n.topic,{permissions:i}),t}))}isJsonRpcAuthorized(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){const n=yield this.sequence.settled.get(e);if(t.publicKey!==n.permissions.controller.publicKey&&!n.permissions.jsonrpc.methods.includes(r.method)){const e=o.ERROR.UNAUTHORIZED_JSON_RPC_METHOD.format({method:r.method});throw this.sequence.logger.error(e.message),new Error(e.message)}}))}isNotificationAuthorized(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){const n=yield this.sequence.settled.get(e);if(t.publicKey!==n.permissions.controller.publicKey&&n.self.publicKey!==n.permissions.controller.publicKey&&!n.permissions.notifications.types.includes(r)){const e=o.ERROR.UNAUTHORIZED_NOTIFICATION_TYPE.format({type:r});throw this.sequence.logger.error(e.message),new Error(e.message)}}))}recordPayloadEvent(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r,chainId:n}=e;s.isJsonRpcRequest(r)?yield this.sequence.history.set(t,r,n):yield this.sequence.history.resolve(r)}))}shouldIgnorePayloadEvent(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r}=e;if(!this.sequence.settled.sequences.has(t))return!0;let n=!1;try{if(s.isJsonRpcRequest(r))n=yield this.sequence.history.exists(t,r.id);else{let e;try{e=yield this.sequence.history.get(t,r.id)}catch(e){}n=void 0!==e&&void 0!==e.response}}catch(e){}return n}))}onPayloadEvent(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r,chainId:n}=e;if(!(yield this.shouldIgnorePayloadEvent(e))){if(s.isJsonRpcRequest(r)){const e={topic:t,request:r,chainId:n},i=this.sequence.config.events.request;this.sequence.logger.info("Emitting "+i),this.sequence.logger.debug({type:"event",event:i,sequence:e}),this.sequence.events.emit(i,e)}else{const e={topic:t,response:r,chainId:n},i=this.sequence.config.events.response;this.sequence.logger.info("Emitting "+i),this.sequence.logger.debug({type:"event",event:i,sequence:e}),this.sequence.events.emit(i,e)}yield this.recordPayloadEvent(e)}}))}onPendingPayloadEvent(e){return n.__awaiter(this,void 0,void 0,(function*(){if(s.isJsonRpcRequest(e.payload))switch(e.payload.method){case this.sequence.config.jsonrpc.approve:case this.sequence.config.jsonrpc.reject:this.onResponse(e)}else this.onAcknowledge(e)}))}onPendingStatusEvent(e){return n.__awaiter(this,void 0,void 0,(function*(){const{sequence:t}=e;if(o.isSignalTypePairing(t.proposal.signal)&&!(yield this.sequence.client.crypto.hasKeys(t.proposal.topic))){const e=yield this.sequence.client.pairing.settled.get(t.proposal.signal.params.topic);yield this.sequence.client.crypto.generateSharedKey(e.self,e.peer,t.proposal.topic)}if(o.isSequenceResponded(t)){const r=this.sequence.config.events.responded;if(this.sequence.logger.info("Emitting "+r),this.sequence.logger.debug({type:"event",event:r,sequence:t}),this.sequence.events.emit(r,t),!o.isStoreUpdatedEvent(e)){const{topic:e,outcome:r,relay:n}=t,i=o.isSequenceFailed(r)?this.sequence.config.jsonrpc.reject:this.sequence.config.jsonrpc.approve,a=o.isSequenceFailed(r)?{reason:r.reason}:{relay:r.relay,responder:r.responder,expiry:r.expiry,state:r.state},c=s.formatJsonRpcRequest(i,a);yield this.sequence.client.relayer.publish(e,c,{relay:n})}}else{const e=this.sequence.config.events.proposed;if(this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,sequence:t}),this.sequence.events.emit(e,t),o.isSignalTypePairing(t.proposal.signal)){const e=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.propose,t.proposal);yield this.sequence.client.pairing.send(t.proposal.signal.params.topic,e)}}}))}subscribeNewPending(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,sequence:r}=e,n=o.calcExpiry(a.ONE_DAY);yield this.sequence.client.relayer.subscribe(t,{relay:r.relay}),yield this.sequence.expirer.set(t,{topic:t,expiry:n})}))}subscribeNewSettled(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,sequence:r}=e,{expiry:n}=r;yield this.sequence.client.relayer.subscribe(t,{relay:r.relay}),yield this.sequence.expirer.set(t,{topic:t,expiry:n})}))}registerEventListeners(){this.sequence.pending.on(a.STORE_EVENTS.created,e=>n.__awaiter(this,void 0,void 0,(function*(){yield this.subscribeNewPending(e),yield this.onPendingStatusEvent(e)}))),this.sequence.pending.on(a.STORE_EVENTS.updated,e=>n.__awaiter(this,void 0,void 0,(function*(){return yield this.onPendingStatusEvent(e)}))),this.sequence.pending.on(a.STORE_EVENTS.deleted,e=>n.__awaiter(this,void 0,void 0,(function*(){const{sequence:t}=e;yield this.sequence.client.relayer.unsubscribe(t.topic,{relay:t.relay}),yield this.sequence.expirer.del(t.topic)}))),this.sequence.settled.on(a.STORE_EVENTS.created,e=>n.__awaiter(this,void 0,void 0,(function*(){yield this.subscribeNewSettled(e);const{sequence:t}=e,r=this.sequence.config.events.settled;this.sequence.logger.info("Emitting "+r),this.sequence.logger.debug({type:"event",event:r,sequence:t}),this.sequence.events.emit(r,t)}))),this.sequence.settled.on(a.STORE_EVENTS.updated,e=>n.__awaiter(this,void 0,void 0,(function*(){const{sequence:t,update:r}=e;if(void 0!==r.state){const e=this.sequence.config.events.updated;this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,sequence:t,update:r}),this.sequence.events.emit(e,t,r)}else if(void 0!==r.permissions){const e=this.sequence.config.events.upgraded,n=r;this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,sequence:t,upgrade:n}),this.sequence.events.emit(e,t,n)}}))),this.sequence.settled.on(a.STORE_EVENTS.deleted,e=>n.__awaiter(this,void 0,void 0,(function*(){const{sequence:t,reason:r}=e,n=this.sequence.config.events.deleted;this.sequence.logger.info("Emitting "+n),this.sequence.logger.debug({type:"event",event:n,sequence:t,reason:r}),this.sequence.events.emit(n,t,r);const i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.delete,{reason:r});yield this.sequence.history.delete(t.topic),yield this.sequence.client.relayer.publish(t.topic,i,{relay:t.relay}),yield this.sequence.client.relayer.unsubscribe(t.topic,{relay:t.relay}),yield this.sequence.expirer.del(t.topic)}))),this.sequence.settled.on(a.STORE_EVENTS.sync,()=>this.sequence.events.emit(this.sequence.config.events.sync)),this.sequence.client.relayer.on(a.RELAYER_EVENTS.payload,e=>{this.sequence.pending.sequences.has(e.topic)?this.onPendingPayloadEvent(e):this.sequence.settled.sequences.has(e.topic)&&this.onMessage(e)}),this.sequence.expirer.on(a.EXPIRER_EVENTS.expired,e=>n.__awaiter(this,void 0,void 0,(function*(){if(this.sequence.pending.sequences.has(e.topic)){const t=o.ERROR.EXPIRED.format({context:o.formatMessageContext(this.sequence.pending.context)});this.sequence.pending.delete(e.topic,t)}else{const t=o.ERROR.EXPIRED.format({context:o.formatMessageContext(this.sequence.settled.context)});this.sequence.settled.delete(e.topic,t)}})))}}t.Engine=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Expirer=void 0;const n=r(5),i=r(10),o=r(17),s=r(11),a=r(12),c=r(9);class u extends o.IExpirer{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.expirations=new Map,this.events=new i.EventEmitter,this.name=c.EXPIRER_CONTEXT,this.cached=[],this.client,this.logger=s.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return s.getLoggerContext(this.logger)}get length(){return this.expirations.size}get topics(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}init(){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}has(e){return n.__awaiter(this,void 0,void 0,(function*(){try{return void 0!==this.getExpiration(e)}catch(e){return!1}}))}set(e,t){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.expirations.set(e,t),this.checkExpiry(e,t),this.events.emit(c.EXPIRER_EVENTS.created,{topic:e,expiration:t})}))}get(e){return n.__awaiter(this,void 0,void 0,(function*(){return yield this.isInitialized(),this.getExpiration(e)}))}del(e){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized();const t=this.getExpiration(e);this.expirations.delete(e),this.events.emit(c.EXPIRER_EVENTS.deleted,{topic:e,expiration:t})}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}persist(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.client.storage.setSequenceStore(this.context,this.values),this.events.emit(c.EXPIRER_EVENTS.sync)}))}restore(){return n.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.client.storage.getSequenceStore(this.context);if(void 0===e)return;if(!e.length)return;if(this.expirations.size){const e=a.ERROR.RESTORE_WILL_OVERRIDE.format({context:a.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,this.logger.debug("Successfully Restored expirations for "+a.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug("Failed to Restore expirations for "+a.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),this.reset(),this.onInit()}))}reset(){this.cached.forEach(e=>this.expirations.set(e.topic,e))}onInit(){this.cached=[],this.events.emit(c.EXPIRER_EVENTS.init)}isInitialized(){return n.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(c.EXPIRER_EVENTS.init,()=>e())})}))}getExpiration(e){const t=this.expirations.get(e);if(!t){const t=a.ERROR.NO_MATCHING_ID.format({context:a.formatMessageContext(this.context),topic:e});throw new Error(t.message)}return t}checkExpiry(e,t){const{expiry:r}=t;a.toMiliseconds(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(c.EXPIRER_EVENTS.expired,{topic:e,expiration:t})}checkExpirations(){this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.client.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(c.EXPIRER_EVENTS.created,e=>{const t=c.EXPIRER_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(c.EXPIRER_EVENTS.expired,e=>{const t=c.EXPIRER_EVENTS.expired;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(c.EXPIRER_EVENTS.deleted,e=>{const t=c.EXPIRER_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}}t.Expirer=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Store=void 0;const n=r(5),i=r(10),o=r(17),s=r(12),a=r(9),c=r(11);class u extends o.IStore{constructor(e,t,r){super(e,t,r),this.client=e,this.logger=t,this.name=r,this.sequences=new Map,this.events=new i.EventEmitter,this.cached=[],this.logger=c.generateChildLogger(t,this.name),this.registerEventListeners()}init(){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}get context(){return c.getLoggerContext(this.logger)}get length(){return this.sequences.size}get topics(){return Array.from(this.sequences.keys())}get values(){return Array.from(this.sequences.values())}set(e,t){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.sequences.has(e)?this.update(e,t):(this.logger.debug("Setting sequence"),this.logger.trace({type:"method",method:"set",topic:e,sequence:t}),this.sequences.set(e,t),this.events.emit(a.STORE_EVENTS.created,{topic:e,sequence:t}))}))}get(e){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Getting sequence"),this.logger.trace({type:"method",method:"get",topic:e});return yield this.getSequence(e)}))}update(e,t){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Updating sequence"),this.logger.trace({type:"method",method:"update",topic:e,update:t});const r=Object.assign(Object.assign({},yield this.getSequence(e)),t);this.sequences.set(e,r),this.events.emit(a.STORE_EVENTS.updated,{topic:e,sequence:r,update:t})}))}delete(e,t){return n.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),!this.sequences.has(e))return;this.logger.debug("Deleting sequence"),this.logger.trace({type:"method",method:"delete",topic:e,reason:t});const r=yield this.getSequence(e);this.sequences.delete(e),this.events.emit(a.STORE_EVENTS.deleted,{topic:e,sequence:r,reason:t})}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}getSequence(e){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized();const t=this.sequences.get(e);if(!t){const t=s.ERROR.NO_MATCHING_TOPIC.format({context:s.formatMessageContext(this.context),topic:e});throw this.logger.error(t.message),new Error(t.message)}return t}))}persist(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.client.storage.setSequenceStore(this.context,this.values),this.events.emit(a.STORE_EVENTS.sync)}))}restore(){return n.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.client.storage.getSequenceStore(this.context);if(void 0===e)return;if(!e.length)return;if(this.sequences.size){const e=s.ERROR.RESTORE_WILL_OVERRIDE.format({context:s.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,this.logger.debug("Successfully Restored sequences for "+s.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",sequences:this.values})}catch(e){this.logger.debug("Failed to Restore sequences for "+s.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),this.reset(),this.onInit()}))}reset(){this.cached.forEach(e=>this.sequences.set(e.topic,e))}onInit(){this.cached=[],this.events.emit(a.STORE_EVENTS.init)}isInitialized(){return n.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(a.STORE_EVENTS.init,()=>e())})}))}registerEventListeners(){this.events.on(a.STORE_EVENTS.created,e=>{const t=a.STORE_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(a.STORE_EVENTS.updated,e=>{const t=a.STORE_EVENTS.updated;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(a.STORE_EVENTS.deleted,e=>{const t=a.STORE_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}}t.Store=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(100),i=r(31);function o(e){var t=new Float64Array(16);if(e)for(var r=0;r<e.length;r++)t[r]=e[r];return t}t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;var s=new Uint8Array(32);s[0]=9;var a=o([56129,1]);function c(e){for(var t=1,r=0;r<16;r++){var n=e[r]+t+65535;t=Math.floor(n/65536),e[r]=n-65536*t}e[0]+=t-1+37*(t-1)}function u(e,t,r){for(var n=~(r-1),i=0;i<16;i++){var o=n&(e[i]^t[i]);e[i]^=o,t[i]^=o}}function d(e,t,r){for(var n=0;n<16;n++)e[n]=t[n]+r[n]}function l(e,t,r){for(var n=0;n<16;n++)e[n]=t[n]-r[n]}function f(e,t,r){var n,i,o=0,s=0,a=0,c=0,u=0,d=0,l=0,f=0,h=0,p=0,g=0,E=0,y=0,_=0,v=0,R=0,m=0,S=0,T=0,O=0,b=0,N=0,I=0,w=0,A=0,P=0,C=0,L=0,U=0,D=0,x=0,M=r[0],q=r[1],j=r[2],H=r[3],V=r[4],B=r[5],K=r[6],G=r[7],k=r[8],Y=r[9],J=r[10],F=r[11],z=r[12],W=r[13],X=r[14],Q=r[15];o+=(n=t[0])*M,s+=n*q,a+=n*j,c+=n*H,u+=n*V,d+=n*B,l+=n*K,f+=n*G,h+=n*k,p+=n*Y,g+=n*J,E+=n*F,y+=n*z,_+=n*W,v+=n*X,R+=n*Q,s+=(n=t[1])*M,a+=n*q,c+=n*j,u+=n*H,d+=n*V,l+=n*B,f+=n*K,h+=n*G,p+=n*k,g+=n*Y,E+=n*J,y+=n*F,_+=n*z,v+=n*W,R+=n*X,m+=n*Q,a+=(n=t[2])*M,c+=n*q,u+=n*j,d+=n*H,l+=n*V,f+=n*B,h+=n*K,p+=n*G,g+=n*k,E+=n*Y,y+=n*J,_+=n*F,v+=n*z,R+=n*W,m+=n*X,S+=n*Q,c+=(n=t[3])*M,u+=n*q,d+=n*j,l+=n*H,f+=n*V,h+=n*B,p+=n*K,g+=n*G,E+=n*k,y+=n*Y,_+=n*J,v+=n*F,R+=n*z,m+=n*W,S+=n*X,T+=n*Q,u+=(n=t[4])*M,d+=n*q,l+=n*j,f+=n*H,h+=n*V,p+=n*B,g+=n*K,E+=n*G,y+=n*k,_+=n*Y,v+=n*J,R+=n*F,m+=n*z,S+=n*W,T+=n*X,O+=n*Q,d+=(n=t[5])*M,l+=n*q,f+=n*j,h+=n*H,p+=n*V,g+=n*B,E+=n*K,y+=n*G,_+=n*k,v+=n*Y,R+=n*J,m+=n*F,S+=n*z,T+=n*W,O+=n*X,b+=n*Q,l+=(n=t[6])*M,f+=n*q,h+=n*j,p+=n*H,g+=n*V,E+=n*B,y+=n*K,_+=n*G,v+=n*k,R+=n*Y,m+=n*J,S+=n*F,T+=n*z,O+=n*W,b+=n*X,N+=n*Q,f+=(n=t[7])*M,h+=n*q,p+=n*j,g+=n*H,E+=n*V,y+=n*B,_+=n*K,v+=n*G,R+=n*k,m+=n*Y,S+=n*J,T+=n*F,O+=n*z,b+=n*W,N+=n*X,I+=n*Q,h+=(n=t[8])*M,p+=n*q,g+=n*j,E+=n*H,y+=n*V,_+=n*B,v+=n*K,R+=n*G,m+=n*k,S+=n*Y,T+=n*J,O+=n*F,b+=n*z,N+=n*W,I+=n*X,w+=n*Q,p+=(n=t[9])*M,g+=n*q,E+=n*j,y+=n*H,_+=n*V,v+=n*B,R+=n*K,m+=n*G,S+=n*k,T+=n*Y,O+=n*J,b+=n*F,N+=n*z,I+=n*W,w+=n*X,A+=n*Q,g+=(n=t[10])*M,E+=n*q,y+=n*j,_+=n*H,v+=n*V,R+=n*B,m+=n*K,S+=n*G,T+=n*k,O+=n*Y,b+=n*J,N+=n*F,I+=n*z,w+=n*W,A+=n*X,P+=n*Q,E+=(n=t[11])*M,y+=n*q,_+=n*j,v+=n*H,R+=n*V,m+=n*B,S+=n*K,T+=n*G,O+=n*k,b+=n*Y,N+=n*J,I+=n*F,w+=n*z,A+=n*W,P+=n*X,C+=n*Q,y+=(n=t[12])*M,_+=n*q,v+=n*j,R+=n*H,m+=n*V,S+=n*B,T+=n*K,O+=n*G,b+=n*k,N+=n*Y,I+=n*J,w+=n*F,A+=n*z,P+=n*W,C+=n*X,L+=n*Q,_+=(n=t[13])*M,v+=n*q,R+=n*j,m+=n*H,S+=n*V,T+=n*B,O+=n*K,b+=n*G,N+=n*k,I+=n*Y,w+=n*J,A+=n*F,P+=n*z,C+=n*W,L+=n*X,U+=n*Q,v+=(n=t[14])*M,R+=n*q,m+=n*j,S+=n*H,T+=n*V,O+=n*B,b+=n*K,N+=n*G,I+=n*k,w+=n*Y,A+=n*J,P+=n*F,C+=n*z,L+=n*W,U+=n*X,D+=n*Q,R+=(n=t[15])*M,s+=38*(S+=n*j),a+=38*(T+=n*H),c+=38*(O+=n*V),u+=38*(b+=n*B),d+=38*(N+=n*K),l+=38*(I+=n*G),f+=38*(w+=n*k),h+=38*(A+=n*Y),p+=38*(P+=n*J),g+=38*(C+=n*F),E+=38*(L+=n*z),y+=38*(U+=n*W),_+=38*(D+=n*X),v+=38*(x+=n*Q),o=(n=(o+=38*(m+=n*q))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),s=(n=s+i+65535)-65536*(i=Math.floor(n/65536)),a=(n=a+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),E=(n=E+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),_=(n=_+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),R=(n=R+i+65535)-65536*(i=Math.floor(n/65536)),o=(n=(o+=i-1+37*(i-1))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),s=(n=s+i+65535)-65536*(i=Math.floor(n/65536)),a=(n=a+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),E=(n=E+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),_=(n=_+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),R=(n=R+i+65535)-65536*(i=Math.floor(n/65536)),o+=i-1+37*(i-1),e[0]=o,e[1]=s,e[2]=a,e[3]=c,e[4]=u,e[5]=d,e[6]=l,e[7]=f,e[8]=h,e[9]=p,e[10]=g,e[11]=E,e[12]=y,e[13]=_,e[14]=v,e[15]=R}function h(e,t){f(e,t,t)}function p(e,t){for(var r=new Uint8Array(32),n=new Float64Array(80),i=o(),s=o(),p=o(),g=o(),E=o(),y=o(),_=0;_<31;_++)r[_]=e[_];r[31]=127&e[31]|64,r[0]&=248,function(e,t){for(var r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}(n,t);for(_=0;_<16;_++)s[_]=n[_];i[0]=g[0]=1;for(_=254;_>=0;--_){var v=r[_>>>3]>>>(7&_)&1;u(i,s,v),u(p,g,v),d(E,i,p),l(i,i,p),d(p,s,g),l(s,s,g),h(g,E),h(y,i),f(i,p,i),f(p,s,E),d(E,i,p),l(i,i,p),h(s,i),l(p,g,y),f(i,p,a),d(i,i,g),f(p,p,i),f(i,g,y),f(g,s,n),h(s,E),u(i,s,v),u(p,g,v)}for(_=0;_<16;_++)n[_+16]=i[_],n[_+32]=p[_],n[_+48]=s[_],n[_+64]=g[_];var R=n.subarray(32),m=n.subarray(16);!function(e,t){for(var r=o(),n=0;n<16;n++)r[n]=t[n];for(n=253;n>=0;n--)h(r,r),2!==n&&4!==n&&f(r,r,t);for(n=0;n<16;n++)e[n]=r[n]}(R,R),f(m,m,R);var S=new Uint8Array(32);return function(e,t){for(var r=o(),n=o(),i=0;i<16;i++)n[i]=t[i];c(n),c(n),c(n);for(var s=0;s<2;s++){r[0]=n[0]-65517;for(i=1;i<15;i++)r[i]=n[i]-65535-(r[i-1]>>16&1),r[i-1]&=65535;r[15]=n[15]-32767-(r[14]>>16&1);var a=r[15]>>16&1;r[14]&=65535,u(n,r,1-a)}for(i=0;i<16;i++)e[2*i]=255&n[i],e[2*i+1]=n[i]>>8}(S,m),S}function g(e){return p(e,s)}function E(e){if(e.length!==t.SECRET_KEY_LENGTH)throw new Error("x25519: seed must be "+t.SECRET_KEY_LENGTH+" bytes");var r=new Uint8Array(e);return{publicKey:g(r),secretKey:r}}t.scalarMult=p,t.scalarMultBase=g,t.generateKeyPairFromSeed=E,t.generateKeyPair=function(e){var t=n.randomBytes(32,e),r=E(t);return i.wipe(t),r},t.sharedKey=function(e,r,n){if(void 0===n&&(n=!1),e.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(r.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");var i=p(e,r);if(n){for(var o=0,s=0;s<i.length;s++)o|=i[s];if(0===o)throw new Error("X25519: invalid shared key")}return i}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(r(89)),s=r(37),a=r(90);class c{constructor(){this.localStorage=o.default}getKeys(){return n(this,void 0,void 0,(function*(){return Object.keys(this.localStorage)}))}getEntries(){return n(this,void 0,void 0,(function*(){return Object.entries(this.localStorage).map(a.parseEntry)}))}getItem(e){return n(this,void 0,void 0,(function*(){const t=this.localStorage.getItem(e);if(null!==t)return s.safeJsonParse(t)}))}setItem(e,t){return n(this,void 0,void 0,(function*(){this.localStorage.setItem(e,s.safeJsonStringify(t))}))}removeItem(e){return n(this,void 0,void 0,(function*(){this.localStorage.removeItem(e)}))}}t.KeyValueStorage=c,t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.safeJsonParse=function(e){if("string"!=typeof e)throw new Error("Cannot safe json parse value of type "+typeof e);try{return JSON.parse(e)}catch(t){return e}},t.safeJsonStringify=function(e){return"string"==typeof e?e:JSON.stringify(e,(e,t)=>void 0===t?null:t)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(2);class i extends n.IEvents{constructor(e){super(),this.protocol="wc",this.version=2}}},function(e,t){},function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return o})),r.d(t,"c",(function(){return s}));var n=r(26);class i extends n.a{constructor(e){super()}}class o extends n.a{constructor(){super()}}class s extends o{constructor(e){super()}}},function(e,t){},function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return i}));class n{constructor(e,t){this.client=e,this.logger=t}}class i{constructor(e,t,r){this.client=e,this.logger=t}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));class n{constructor(e,t){this.client=e,this.logger=t}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));class n{constructor(e){this.sequence=e}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(2);class i extends n.IEvents{constructor(e,t){super(),this.client=e,this.logger=t}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(2);class i extends n.IEvents{constructor(e){super()}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(2);class i extends n.IEvents{constructor(e,t){super(),this.logger=e,this.storage=t,this.records=new Map}}},function(e,t){},function(e,t){},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(22);class i extends n.a{}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(2);class i extends n.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}},function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return o}));var n=r(2);class i{}class o extends n.IEvents{constructor(e){super()}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(22);class i extends n.a{}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(2);class i extends n.IEvents{constructor(e,t,r){super(),this.client=e,this.logger=t,this.name=r}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return o}));class n{constructor(e,t,r){this.logger=e,this.keyValueStorage=t,this.config=r}}class i extends n{constructor(e,t,r){super(e,t,r),this.logger=e,this.keyValueStorage=t,this.config=r}}class o extends i{constructor(e,t,r){super(e,t,r),this.logger=e,this.keyValueStorage=t,this.config=r}}},function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return o}));var n=r(2);class i{constructor(){this.map=new Map}}class o extends n.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(6);function i(e){return n.getBrowerCrypto().getRandomValues(new Uint8Array(e))}},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,u=[],d=!1,l=-1;function f(){d&&c&&(d=!1,c.length?u=c.concat(u):l=-1,u.length&&h())}function h(){if(!d){var e=a(f);d=!0;for(var t=u.length;t;){for(c=u,u=[];++l<t;)c&&c[l].run();l=-1,t=u.length}c=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||d||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return o}));var n=r(14);function i(e,t,r){return Object(n.b)(e,t,r)}function o(e,t,r){return Object(n.a)(e,t,r)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s}));var n=r(14),i=r(27);async function o(e,t){return await Object(n.c)(e,t)}async function s(e,t,r){const o=await Object(n.c)(e,t);return Object(i.isConstantTime)(o,r)}},function(e,t,r){"use strict";var n=r(6);r.o(n,"ERROR_BAD_MAC")&&r.d(t,"ERROR_BAD_MAC",(function(){return n.ERROR_BAD_MAC})),r.o(n,"IV_LENGTH")&&r.d(t,"IV_LENGTH",(function(){return n.IV_LENGTH})),r.o(n,"KEY_LENGTH")&&r.d(t,"KEY_LENGTH",(function(){return n.KEY_LENGTH})),r.o(n,"LENGTH_0")&&r.d(t,"LENGTH_0",(function(){return n.LENGTH_0})),r.o(n,"MAC_LENGTH")&&r.d(t,"MAC_LENGTH",(function(){return n.MAC_LENGTH})),r.o(n,"assert")&&r.d(t,"assert",(function(){return n.assert})),r.o(n,"decryptWithSharedKey")&&r.d(t,"decryptWithSharedKey",(function(){return n.decryptWithSharedKey})),r.o(n,"derive")&&r.d(t,"derive",(function(){return n.derive})),r.o(n,"encryptWithSharedKey")&&r.d(t,"encryptWithSharedKey",(function(){return n.encryptWithSharedKey})),r.o(n,"generateKeyPair")&&r.d(t,"generateKeyPair",(function(){return n.generateKeyPair})),r.o(n,"isConstantTime")&&r.d(t,"isConstantTime",(function(){return n.isConstantTime}))},function(e,t,r){"use strict"},function(e,t){},function(e,t,r){"use strict";function n(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return o}));var n=r(14);async function i(e){return await Object(n.e)(e)}async function o(e){return await Object(n.f)(e)}},function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return c}));var n=r(3),i=r(1),o=r(15);async function s(e){const t=await Object(n.sha512)(e);return{encryptionKey:Object(o.d)(t),macKey:Object(o.e)(t)}}async function a(e,t,r,a=Object(n.randomBytes)(n.IV_LENGTH)){const{encryptionKey:c,macKey:u}=await s(t),d=await Object(n.aesCbcEncrypt)(a,c,e),l=Object(i.concatArrays)(a,r,d),f=await Object(n.hmacSha256Sign)(u,l);return Object(o.h)({iv:a,publicKey:r,ciphertext:d,mac:f})}async function c(e,t){const{iv:r,publicKey:a,mac:c,ciphertext:u}=Object(o.b)(e),{encryptionKey:d,macKey:l}=await s(t),f=Object(i.concatArrays)(r,a,u),h=await Object(n.hmacSha256Verify)(l,f,c);Object(n.assert)(h,n.ERROR_BAD_MAC);return await Object(n.aesCbcDecrypt)(r,d,u)}},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var n=r(96),i=r(97),o=r(98);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,r){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return u(this,e,t,r)}function u(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=f(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),i=(e=a(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(c.isBuffer(t)){var r=0|h(t.length);return 0===(e=a(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?a(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(d(t),e=a(e,t<0?0:0|h(t)),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function f(e,t){var r=t.length<0?0:0|h(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function h(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return B(e).length;default:if(n)return V(e).length;t=(""+t).toLowerCase(),n=!0}}function g(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,r);case"utf8":case"utf-8":return N(this,t,r);case"ascii":return I(this,t,r);case"latin1":case"binary":return w(this,t,r);case"base64":return b(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function E(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:_(e,t,r,n,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):_(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,r,n,i){var o,s=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var d=-1;for(o=r;o<a;o++)if(u(e,o)===u(t,-1===d?0:o-d)){if(-1===d&&(d=o),o-d+1===c)return d*s}else-1!==d&&(o-=o-d),d=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var l=!0,f=0;f<c;f++)if(u(e,o+f)!==u(t,f)){l=!1;break}if(l)return o}return-1}function v(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function R(e,t,r,n){return K(V(t,e.length-r),e,r,n)}function m(e,t,r,n){return K(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function S(e,t,r,n){return m(e,t,r,n)}function T(e,t,r,n){return K(B(t),e,r,n)}function O(e,t,r,n){return K(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function b(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function N(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,c,u=e[i],d=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=r)switch(l){case 1:u<128&&(d=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(d=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(d=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(d=c)}null===d?(d=65533,l=1):d>65535&&(d-=65536,n.push(d>>>10&1023|55296),d=56320|1023&d),n.push(d),i+=l}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,r){return u(null,e,t,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,r){return function(e,t,r,n){return d(t),t<=0?a(e,t):void 0!==r?"string"==typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}(null,e,t,r)},c.allocUnsafe=function(e){return l(null,e)},c.allocUnsafeSlow=function(e){return l(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=c.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)E(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)E(this,t,t+3),E(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)E(this,t,t+7),E(this,t+1,t+6),E(this,t+2,t+5),E(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?N(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,n,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(o,s),u=this.slice(n,i),d=e.slice(t,r),l=0;l<a;++l)if(u[l]!==d[l]){o=u[l],s=d[l];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return R(this,e,t,r);case"ascii":return m(this,e,t,r);case"latin1":case"binary":return S(this,e,t,r);case"base64":return T(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function I(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function w(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function A(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=H(e[o]);return i}function P(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function C(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,r,n,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function U(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function D(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function x(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(e,t,r,n,o){return o||x(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function q(e,t,r,n,o){return o||x(e,0,r,8),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;r=new c(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},c.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||C(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},c.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||C(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUInt8=function(e,t){return t||C(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||C(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||C(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||C(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||C(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||C(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){t||C(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||L(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||L(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,r){return M(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return M(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return q(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return q(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},c.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=c.isBuffer(e)?e:V(new c(e,n).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var j=/[^+\/0-9A-Za-z-_]/g;function H(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function B(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function K(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(25))},function(e,t){e.exports=i,i.strict=o,i.loose=s;var r=Object.prototype.toString,n={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function i(e){return o(e)||s(e)}function o(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function s(e){return n[r.call(e)]}},function(e,t){},function(e,t,r){"use strict";r(7),r(16)},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={waku:{info:"waku_info",connect:"waku_connect",disconnect:"waku_disconnect",publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"}}},function(e,t,r){"use strict";r.r(t),r.d(t,"isNodeJs",(function(){return o}));var n=r(6);for(var i in n)["default","isNodeJs"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i);const o=n.isNode},function(e,t,r){"use strict";r.d(t,"e",(function(){return o})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return a})),r.d(t,"b",(function(){return c})),r.d(t,"a",(function(){return u}));var n=r(20),i=r(4);function o(){return Date.now()*Math.pow(10,3)+Math.floor(Math.random()*Math.pow(10,3))}function s(e,t,r){return{id:r||o(),jsonrpc:"2.0",method:e,params:t}}function a(e,t){return{id:e,jsonrpc:"2.0",result:t}}function c(e,t){return{id:e,jsonrpc:"2.0",error:u(t)}}function u(e){return void 0===e?Object(n.a)(i.a):("string"==typeof e&&(e=Object.assign(Object.assign({},Object(n.a)(i.g)),{message:e})),Object(n.c)(e.code)&&(e=Object(n.b)(e.code)),e)}},function(e,t,r){"use strict";function n(e){return e.includes("*")?o(e):!/\W/g.test(e)}function i(e){return"*"===e}function o(e){return!!i(e)||!!e.includes("*")&&(2===e.split("*").length&&1===e.split("*").filter(e=>""===e.trim()).length)}function s(e){return!i(e)&&o(e)&&!e.split("*")[0].trim()}function a(e){return!i(e)&&o(e)&&!e.split("*")[1].trim()}r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){return i})),r.d(t,"e",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"d",(function(){return a}))},function(e,t,r){"use strict";r.r(t);var n=r(2);for(var i in n)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i)},function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"c",(function(){return o})),r.d(t,"b",(function(){return s}));function n(e,t){const r=function(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(t&&t.length)return t[0]}(e);return void 0!==r&&new RegExp(t).test(r)}function i(e){return n(e,"^https?:")}function o(e){return n(e,"^wss?:")}function s(e){return new RegExp("wss?://localhost(:d{2,5})?").test(e)}},function(e,t,r){"use strict";function n(e){return"id"in e&&"jsonrpc"in e&&"2.0"===e.jsonrpc}function i(e){return n(e)&&"method"in e}function o(e){return n(e)&&(s(e)||a(e))}function s(e){return"result"in e}function a(e){return"error"in e}function c(e){return"error"in e&&!1===e.valid}r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return s})),r.d(t,"a",(function(){return a})),r.d(t,"f",(function(){return c}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PINO_CUSTOM_CONTEXT_KEY=t.PINO_LOGGER_DEFAULTS=void 0,t.PINO_LOGGER_DEFAULTS={level:"info",prettyPrint:{colorize:!0,translateTime:"SYS:standard",ignore:"pid,hostname"}},t.PINO_CUSTOM_CONTEXT_KEY="custom_context"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RelayerEncoder=t.Encoder=void 0;const n=r(5),i=n.__importStar(r(1)),o=r(11),s=r(19),a=r(9);t.Encoder=class{constructor(e,t){this.client=e,this.logger=t,this.name=a.ENCODER_CONTEXT,this.client=e,this.logger=o.generateChildLogger(t,this.name)}get context(){return o.getLoggerContext(this.logger)}encode(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=s.safeJsonStringify(t);return(yield this.client.crypto.hasKeys(e))?yield this.client.crypto.encrypt(e,r):i.utf8ToHex(r)}))}decode(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=(yield this.client.crypto.hasKeys(e))?yield this.client.crypto.decrypt(e,t):i.hexToUtf8(t);return s.safeJsonParse(r)}))}};t.RelayerEncoder=class{encode(e,t){return n.__awaiter(this,void 0,void 0,(function*(){return i.utf8ToHex(s.safeJsonStringify(t))}))}decode(e,t){return n.__awaiter(this,void 0,void 0,(function*(){return s.safeJsonParse(i.hexToUtf8(t))}))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeartBeat=void 0;const n=r(5),i=n.__importDefault(r(30)),o=r(10),s=r(17),a=r(9),c=r(11),u=r(12);class d extends s.IHeartBeat{constructor(e){super(e),this.events=new o.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.name=a.HEARTBEAT_CONTEXT,this.logger=void 0!==(null==e?void 0:e.logger)&&"string"!=typeof(null==e?void 0:e.logger)?c.generateChildLogger(e.logger,this.name):i.default(c.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||a.HEARTBEAT_DEFAULT_LOGGER})),this.interval=(null==e?void 0:e.interval)||a.HEARTBEAT_INTERVAL}static init(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=new d(e);return yield t.init(),t}))}get context(){return c.getLoggerContext(this.logger)}init(){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}initialize(){return n.__awaiter(this,void 0,void 0,(function*(){setInterval(()=>this.pulse(),u.toMiliseconds(this.interval)),this.logger.trace("Initialized")}))}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}t.HeartBeat=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subscriber=t.SubscriberTopicMap=void 0;const n=r(5),i=r(10),o=r(17),s=r(12),a=r(11),c=r(9);class u{constructor(){this.map=new Map}get topics(){return Array.from(this.map.keys())}set(e,t){const r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])}get(e){return this.map.get(e)||[]}exists(e,t){return this.get(e).includes(t)}delete(e,t){if(void 0===t)return void this.map.delete(e);if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,t))return;const n=r.filter(e=>e!==t);n.length?this.map.set(e,n):this.map.delete(e)}clear(){this.map.clear()}}t.SubscriberTopicMap=u;class d extends o.ISubscriber{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new u,this.events=new i.EventEmitter,this.name=c.SUBSCRIBER_CONTEXT,this.pending=new Map,this.cached=[],this.relayer=e,this.logger=a.generateChildLogger(t,this.name),this.registerEventListeners()}init(){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}get context(){return a.getLoggerContext(this.logger)}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}subscribe(e,t){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{const r=s.getRelayProtocolName(t),n={topic:e,relay:r};this.pending.set(e,n);const i=yield this.rpcSubscribe(e,r);return yield this.onSubscribe(i,n),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}}),i}catch(e){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(e),e}}))}unsubscribe(e,t){return n.__awaiter(this,void 0,void 0,(function*(){void 0!==(null==t?void 0:t.id)?yield this.unsubscribeById(e,t.id,t):yield this.unsubscribeByTopic(e,t)}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}enable(){return n.__awaiter(this,void 0,void 0,(function*(){this.cached.length&&this.onEnable()}))}disable(){return n.__awaiter(this,void 0,void 0,(function*(){this.cached.length||this.onDisable()}))}hasSubscription(e,t){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled();let r=!1;try{r=(yield this.getSubscription(e)).topic===t}catch(e){}return r}))}onEnable(){this.cached=[],this.events.emit(c.SUBSCRIBER_EVENTS.enabled)}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.events.emit(c.SUBSCRIBER_EVENTS.disabled)}unsubscribeByTopic(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=this.topicMap.get(e);yield Promise.all(r.map(r=>n.__awaiter(this,void 0,void 0,(function*(){return yield this.unsubscribeById(e,r,t)}))))}))}unsubscribeById(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{const n=s.getRelayProtocolName(r);yield this.rpcUnsubscribe(e,t,n);const i=s.ERROR.DELETED.format({context:s.formatMessageContext(this.context)});yield this.onUnsubscribe(e,t,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(e){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e),e}}))}rpcSubscribe(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r={method:s.getRelayProtocolApi(t.protocol).subscribe,params:{topic:e}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.provider.request(r)}))}rpcUnsubscribe(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){const n={method:s.getRelayProtocolApi(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.provider.request(n)}))}onSubscribe(e,t){return n.__awaiter(this,void 0,void 0,(function*(){yield this.setSubscription(e,Object.assign(Object.assign({},t),{id:e})),this.pending.delete(t.topic)}))}onResubscribe(e,t){return n.__awaiter(this,void 0,void 0,(function*(){yield this.addSubscription(e,Object.assign(Object.assign({},t),{id:e})),this.pending.delete(t.topic)}))}onUnsubscribe(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){this.events.removeAllListeners(t),(yield this.hasSubscription(t,e))&&(yield this.deleteSubscription(t,r)),yield this.relayer.history.delete(e)}))}setSubscription(e,t){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),yield this.addSubscription(e,t))}))}addSubscription(e,t){return n.__awaiter(this,void 0,void 0,(function*(){this.subscriptions.set(e,Object.assign({},t)),this.topicMap.set(t.topic,e),this.events.emit(c.SUBSCRIBER_EVENTS.created,t)}))}getSubscription(e){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const t=s.ERROR.NO_MATCHING_ID.format({context:s.formatMessageContext(this.context),id:e});throw new Error(t.message)}return t}))}deleteSubscription(e,t){return n.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const r=yield this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(c.SUBSCRIBER_EVENTS.deleted,Object.assign(Object.assign({},r),{reason:t}))}))}persist(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.relayer.storage.setRelayerSubscriptions(this.context,this.values),this.events.emit(c.SUBSCRIBER_EVENTS.sync)}))}restore(){return n.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.relayer.storage.getRelayerSubscriptions(this.context);if(void 0===e)return;if(!e.length)return;if(this.subscriptions.size){const e=s.ERROR.RESTORE_WILL_OVERRIDE.format({context:s.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,this.logger.debug("Successfully Restored subscriptions for "+s.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug("Failed to Restore subscriptions for "+s.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),yield this.reset(),yield this.enable()}))}isEnabled(){return n.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(c.SUBSCRIBER_EVENTS.enabled,()=>e())})}))}reset(){return n.__awaiter(this,void 0,void 0,(function*(){this.cached.length&&(yield Promise.all(this.cached.map(e=>n.__awaiter(this,void 0,void 0,(function*(){return this.resubscribe(e)})))))}))}resubscribe(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,relay:r}=e,n={topic:t,relay:r};this.pending.set(n.topic,n);const i=yield this.rpcSubscribe(n.topic,n.relay);if(yield this.onResubscribe(i,n),this.ids.includes(e.id)){const t=s.ERROR.RESUBSCRIBED.format({topic:e.topic});yield this.deleteSubscription(e.id,t)}}))}onConnect(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.reset(),yield this.enable()}))}onDisconnect(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.disable()}))}checkPending(){this.pending.forEach(e=>n.__awaiter(this,void 0,void 0,(function*(){const t=yield this.rpcSubscribe(e.topic,e.relay);yield this.onSubscribe(t,e)})))}registerEventListeners(){this.relayer.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.provider.on(c.RELAYER_PROVIDER_EVENTS.connect,()=>n.__awaiter(this,void 0,void 0,(function*(){yield this.onConnect()}))),this.relayer.provider.on(c.RELAYER_PROVIDER_EVENTS.disconnect,()=>n.__awaiter(this,void 0,void 0,(function*(){yield this.onDisconnect()}))),this.events.on(c.SUBSCRIBER_EVENTS.created,e=>n.__awaiter(this,void 0,void 0,(function*(){const t=c.SUBSCRIBER_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),yield this.persist()}))),this.events.on(c.SUBSCRIBER_EVENTS.deleted,e=>n.__awaiter(this,void 0,void 0,(function*(){const t=c.SUBSCRIBER_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),yield this.persist()})))}}t.Subscriber=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=t.RelayerStorage=t.BaseStorage=void 0;const n=r(5),i=r(11),o=r(12),s=r(9);class a{constructor(e,t,r){this.logger=e,this.keyValueStorage=t,this.config=r,this.name=s.STORAGE_CONTEXT,this.version=s.STORAGE_VERSION,this.keyMap=s.STORAGE_KEYS,this.logger=i.generateChildLogger(e,this.name),this.keyValueStorage=t,this.config=r}get context(){return i.getLoggerContext(this.logger)}get prefix(){return`${this.config.protocol}@${this.config.version}:${this.config.context}:${this.version}`}getStorageKey(e){const t=this.getStorageKeyName(e);if(!this.isValidStorageKeyName(t)){const e=o.ERROR.INVALID_STORAGE_KEY_NAME.format({name:t});throw new Error(e.message)}return this.prefix+"//"+t}getStorageKeyName(e){return o.formatStorageKeyName(e)}isValidStorageKeyName(e){return Object.keys(this.keyMap).map(e=>Object.values(this.keyMap[e])).flat().includes(e.toLowerCase())}}t.BaseStorage=a;class c extends a{constructor(e,t,r){super(e,t,r),this.logger=e,this.keyValueStorage=t,this.config=r}setJsonRpcRecords(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=this.getStorageKey(e);yield this.keyValueStorage.setItem(r,t)}))}getJsonRpcRecords(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}setRelayerSubscriptions(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=this.getStorageKey(e);yield this.keyValueStorage.setItem(r,t)}))}getRelayerSubscriptions(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}}t.RelayerStorage=c;t.Storage=class extends c{constructor(e,t,r){super(e,t,r),this.logger=e,this.keyValueStorage=t,this.config=r}setKeyChain(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=this.getStorageKey(e);yield this.keyValueStorage.setItem(r,o.mapToObj(t))}))}getKeyChain(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e),r=yield this.keyValueStorage.getItem(t);return void 0!==r?o.objToMap(r):void 0}))}setSequenceStore(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=this.getStorageKey(e);yield this.keyValueStorage.setItem(r,t)}))}getSequenceStore(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}setExpirations(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=this.getStorageKey(e);yield this.keyValueStorage.setItem(r,t)}))}getExpirations(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}}},function(e,t,r){(function(t){var r=/^\[object .+?Constructor\]$/,n="object"==typeof t&&t&&t.Object===Object&&t,i="object"==typeof self&&self&&self.Object===Object&&self,o=n||i||Function("return this")();function s(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function a(e,t){return!!(e?e.length:0)&&function(e,t,r){if(t!=t)return function(e,t,r,n){var i=e.length,o=r+(n?1:-1);for(;n?o--:++o<i;)if(t(e[o],o,e))return o;return-1}(e,d,r);var n=r-1,i=e.length;for(;++n<i;)if(e[n]===t)return n;return-1}(e,t,0)>-1}function c(e,t,r){for(var n=-1,i=e?e.length:0;++n<i;)if(r(t,e[n]))return!0;return!1}function u(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function d(e){return e!=e}function l(e,t){return e.has(t)}function f(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var h,p=Array.prototype,g=Function.prototype,E=Object.prototype,y=o["__core-js_shared__"],_=(h=/[^.]+$/.exec(y&&y.keys&&y.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"",v=g.toString,R=E.hasOwnProperty,m=E.toString,S=RegExp("^"+v.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),T=o.Symbol,O=E.propertyIsEnumerable,b=p.splice,N=T?T.isConcatSpreadable:void 0,I=Math.max,w=H(o,"Map"),A=H(o,"Set"),P=H(Object,"create");function C(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function L(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function U(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function D(e){var t=-1,r=e?e.length:0;for(this.__data__=new U;++t<r;)this.add(e[t])}function x(e,t){for(var r,n,i=e.length;i--;)if((r=e[i][0])===(n=t)||r!=r&&n!=n)return i;return-1}function M(e){return!(!z(e)||(t=e,_&&_ in t))&&(F(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?S:r).test(function(e){if(null!=e){try{return v.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}C.prototype.clear=function(){this.__data__=P?P(null):{}},C.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},C.prototype.get=function(e){var t=this.__data__;if(P){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return R.call(t,e)?t[e]:void 0},C.prototype.has=function(e){var t=this.__data__;return P?void 0!==t[e]:R.call(t,e)},C.prototype.set=function(e,t){return this.__data__[e]=P&&void 0===t?"__lodash_hash_undefined__":t,this},L.prototype.clear=function(){this.__data__=[]},L.prototype.delete=function(e){var t=this.__data__,r=x(t,e);return!(r<0)&&(r==t.length-1?t.pop():b.call(t,r,1),!0)},L.prototype.get=function(e){var t=this.__data__,r=x(t,e);return r<0?void 0:t[r][1]},L.prototype.has=function(e){return x(this.__data__,e)>-1},L.prototype.set=function(e,t){var r=this.__data__,n=x(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},U.prototype.clear=function(){this.__data__={hash:new C,map:new(w||L),string:new C}},U.prototype.delete=function(e){return j(this,e).delete(e)},U.prototype.get=function(e){return j(this,e).get(e)},U.prototype.has=function(e){return j(this,e).has(e)},U.prototype.set=function(e,t){return j(this,e).set(e,t),this},D.prototype.add=D.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},D.prototype.has=function(e){return this.__data__.has(e)};var q=A&&1/f(new A([,-0]))[1]==1/0?function(e){return new A(e)}:function(){};function j(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function H(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return M(r)?r:void 0}function V(e){return k(e)||function(e){return J(e)&&R.call(e,"callee")&&(!O.call(e,"callee")||"[object Arguments]"==m.call(e))}(e)||!!(N&&e&&e[N])}var B,K,G=(B=function(e){return function(e,t,r){var n=-1,i=a,o=e.length,s=!0,u=[],d=u;if(r)s=!1,i=c;else if(o>=200){var h=t?null:q(e);if(h)return f(h);s=!1,i=l,d=new D}else d=t?[]:u;e:for(;++n<o;){var p=e[n],g=t?t(p):p;if(p=r||0!==p?p:0,s&&g==g){for(var E=d.length;E--;)if(d[E]===g)continue e;t&&d.push(g),u.push(p)}else i(d,g,r)||(d!==u&&d.push(g),u.push(p))}return u}(function e(t,r,n,i,o){var s=-1,a=t.length;for(n||(n=V),o||(o=[]);++s<a;){var c=t[s];r>0&&n(c)?r>1?e(c,r-1,n,i,o):u(o,c):i||(o[o.length]=c)}return o}(e,1,J,!0))},K=I(void 0===K?B.length-1:K,0),function(){for(var e=arguments,t=-1,r=I(e.length-K,0),n=Array(r);++t<r;)n[t]=e[K+t];t=-1;for(var i=Array(K+1);++t<K;)i[t]=e[t];return i[K]=n,s(B,this,i)});var k=Array.isArray;function Y(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!F(e)}function J(e){return function(e){return!!e&&"object"==typeof e}(e)&&Y(e)}function F(e){var t=z(e)?m.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}function z(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=G}).call(this,r(25))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWindowMetadata=void 0;const n=r(24);t.getWindowMetadata=function(){let e,t;try{e=n.getDocumentOrThrow(),t=n.getLocationOrThrow()}catch(e){return null}function r(...t){const r=e.getElementsByTagName("meta");for(let e=0;e<r.length;e++){const n=r[e],i=["itemprop","property","name"].map(e=>n.getAttribute(e)).filter(e=>!!e&&t.includes(e));if(i.length&&i){const e=n.getAttribute("content");if(e)return e}}return""}const i=function(){let t=r("name","og:site_name","og:title","twitter:title");return t||(t=e.title),t}();return{description:r("description","og:description","twitter:description","keywords"),url:t.origin,icons:function(){const r=e.getElementsByTagName("link"),n=[];for(let e=0;e<r.length;e++){const i=r[e],o=i.getAttribute("rel");if(o&&o.toLowerCase().indexOf("icon")>-1){const e=i.getAttribute("href");if(e)if(-1===e.toLowerCase().indexOf("https:")&&-1===e.toLowerCase().indexOf("http:")&&0!==e.indexOf("//")){let r=t.protocol+"//"+t.host;if(0===e.indexOf("/"))r+=e;else{const n=t.pathname.split("/");n.pop();r+=n.join("/")+"/"+e}n.push(r)}else if(0===e.indexOf("//")){const r=t.protocol+e;n.push(r)}else n.push(e)}}return n}(),name:i}}},function(e,t,r){"use strict";var n=r(69);r.o(n,"RELAY_JSONRPC")&&r.d(t,"RELAY_JSONRPC",(function(){return n.RELAY_JSONRPC}));r(70);var i=r(71);r.d(t,"RELAY_JSONRPC",(function(){return i.a}));r(16)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const n=r(5),i=r(87);n.__exportStar(r(9),t),t.Client=i.Client,t.default=i.Client},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const n=r(5),i=r(10),o=n.__importDefault(r(30)),s=n.__importDefault(r(36)),a=r(17),c=r(12),u=r(8),d=r(11),l=r(112),f=r(9);class h extends a.IClient{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new i.EventEmitter,this.name=f.CLIENT_DEFAULT.name;const t=void 0!==(null==e?void 0:e.logger)&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:o.default(d.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||f.CLIENT_DEFAULT.logger}));this.name=(null==e?void 0:e.name)||f.CLIENT_DEFAULT.name,this.controller=(null==e?void 0:e.controller)||f.CLIENT_DEFAULT.controller,this.metadata=(null==e?void 0:e.metadata)||c.getAppMetadata(),this.projectId=null==e?void 0:e.projectId,this.logger=d.generateChildLogger(t,this.name),this.heartbeat=new l.HeartBeat({logger:this.logger}),this.crypto=new l.Crypto(this,this.logger,null==e?void 0:e.keychain),this.encoder=new l.Encoder(this,this.logger);const r=Object.assign(Object.assign({},f.CLIENT_STORAGE_OPTIONS),null==e?void 0:e.storageOptions);this.storage=new l.Storage(this.logger,(null==e?void 0:e.storage)||new s.default(r),{protocol:this.protocol,version:this.version,context:this.context}),this.relayUrl=c.formatRelayRpcUrl(this.protocol,this.version,(null==e?void 0:e.relayUrl)||f.CLIENT_DEFAULT.relayUrl,this.projectId),this.relayer=new l.Relayer({rpcUrl:this.relayUrl,heartbeat:this.heartbeat,encoder:this.encoder,logger:this.logger,storage:this.storage,projectId:this.projectId,keyValueStorageOptions:r}),this.pairing=new l.Pairing(this,this.logger),this.session=new l.Session(this,this.logger)}static init(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=new h(e);return yield t.initialize(),t}))}get context(){return d.getLoggerContext(this.logger)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}connect(e){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Connecting Application"),this.logger.trace({type:"method",method:"connect",params:e});try{void 0===typeof e.pairing&&this.logger.info("Connecing with existing pairing");const t=void 0===e.pairing?yield this.pairing.create():yield this.pairing.get(e.pairing.topic);this.logger.trace({type:"method",method:"connect",pairing:t});const r=e.metadata||this.metadata;if(void 0===r){const e=c.ERROR.MISSING_OR_INVALID.format({name:"app metadata"});throw this.logger.error(e.message),new Error(e.message)}const n=yield this.session.create({signal:{method:f.SESSION_SIGNAL_METHOD_PAIRING,params:{topic:t.topic}},relay:e.relay||{protocol:f.RELAYER_DEFAULT_PROTOCOL},metadata:r,permissions:Object.assign(Object.assign({},e.permissions),{notifications:f.SESSION_EMPTY_PERMISSIONS.notifications})});return this.logger.debug("Application Connection Successful"),this.logger.trace({type:"method",method:"connect",session:n}),n}catch(e){throw this.logger.debug("Application Connection Failure"),this.logger.error(e),e}}))}pair(e){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Pairing"),this.logger.trace({type:"method",method:"pair",params:e});const t=function(e){const t=c.parseUri(e);return{topic:t.topic,relay:t.relay,proposer:{publicKey:t.publicKey,controller:t.controller},signal:{method:f.PAIRING_SIGNAL_METHOD_URI,params:{uri:e}},permissions:{jsonrpc:{methods:[f.SESSION_JSONRPC.propose]},notifications:{types:[]}},ttl:f.PAIRING_DEFAULT_TTL}}(e.uri),r=t.proposer.controller!==this.controller,n=r?void 0:c.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller}),i=yield this.pairing.respond({approved:r,proposal:t,reason:n});if(!c.isPairingResponded(i)){const e=c.ERROR.NO_MATCHING_RESPONSE.format({context:"pairing"});throw this.logger.error(e.message),new Error(e.message)}if(c.isPairingFailed(i.outcome))throw this.logger.debug("Pairing Failure"),this.logger.trace({type:"method",method:"pair",outcome:i.outcome}),new Error(i.outcome.reason.message);this.logger.debug("Pairing Success"),this.logger.trace({type:"method",method:"pair",pending:i});return yield this.pairing.get(i.outcome.topic)}))}approve(e){return n.__awaiter(this,void 0,void 0,(function*(){if(this.logger.debug("Approving Session Proposal"),this.logger.trace({type:"method",method:"approve",params:e}),void 0===e.response){const e=c.ERROR.MISSING_RESPONSE.format({context:"session"});throw this.logger.error(e.message),new Error(e.message)}const t=e.response.state||f.SESSION_EMPTY_STATE,r=e.response.metadata||this.metadata;if(void 0===r){const e=c.ERROR.MISSING_OR_INVALID.format({name:"app metadata"});throw this.logger.error(e.message),new Error(e.message)}const n=e.proposal.proposer.controller!==this.controller,i=n?void 0:c.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller}),o=yield this.session.respond({approved:n,proposal:e.proposal,response:{state:t,metadata:r},reason:i});if(!c.isSessionResponded(o)){const e=c.ERROR.NO_MATCHING_RESPONSE.format({context:"session"});throw this.logger.error(e.message),new Error(e.message)}if(c.isSessionFailed(o.outcome))throw this.logger.debug("Session Proposal Approval Failure"),this.logger.trace({type:"method",method:"approve",outcome:o.outcome}),new Error(o.outcome.reason.message);return this.logger.debug("Session Proposal Approval Success"),this.logger.trace({type:"method",method:"approve",pending:o}),this.session.get(o.outcome.topic)}))}reject(e){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Rejecting Session Proposal"),this.logger.trace({type:"method",method:"reject",params:e});const t=yield this.session.respond({approved:!1,proposal:e.proposal,response:f.SESSION_EMPTY_RESPONSE,reason:e.reason});this.logger.debug("Session Proposal Response Success"),this.logger.trace({type:"method",method:"reject",pending:t})}))}upgrade(e){return n.__awaiter(this,void 0,void 0,(function*(){yield this.session.upgrade(e)}))}update(e){return n.__awaiter(this,void 0,void 0,(function*(){yield this.session.update(e)}))}request(e){return n.__awaiter(this,void 0,void 0,(function*(){return this.session.request(e)}))}respond(e){return n.__awaiter(this,void 0,void 0,(function*(){yield this.session.send(e.topic,e.response)}))}ping(e){return n.__awaiter(this,void 0,void 0,(function*(){yield this.session.ping(e.topic,e.timeout)}))}notify(e){return n.__awaiter(this,void 0,void 0,(function*(){yield this.session.notify(e)}))}disconnect(e){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Disconnecting Application"),this.logger.trace({type:"method",method:"disconnect",params:e}),yield this.session.delete(e)}))}onPairingRequest(e,t){return n.__awaiter(this,void 0,void 0,(function*(){if(e.method===f.SESSION_JSONRPC.propose){const r=e.params;if(r.proposer.controller===this.controller){const e=c.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller});return void(yield this.session.respond({approved:!1,proposal:r,response:f.SESSION_EMPTY_RESPONSE,reason:e}))}const n=f.CLIENT_EVENTS.session.proposal;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:r}),this.events.emit(n,r);const i=u.formatJsonRpcResult(e.id,!0);yield this.pairing.send(t,i)}}))}onPairingSettled(e){return n.__awaiter(this,void 0,void 0,(function*(){e.permissions.controller.publicKey===e.self.publicKey&&void 0===e.state.metadata&&setTimeout(()=>n.__awaiter(this,void 0,void 0,(function*(){return yield this.pairing.update({topic:e.topic,state:{metadata:this.metadata}})})),f.CLIENT_SHORT_TIMEOUT)}))}initialize(){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized");try{yield this.pairing.init(),yield this.session.init(),yield this.crypto.init(),yield this.relayer.init(),yield this.heartbeat.init(),this.registerEventListeners(),this.logger.info("Client Initilization Success")}catch(e){throw this.logger.info("Client Initilization Failure"),this.logger.error(e),e}}))}registerEventListeners(){this.pairing.on(f.PAIRING_EVENTS.proposed,e=>{const t=f.CLIENT_EVENTS.pairing.proposal;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e.proposal}),this.events.emit(t,e.proposal)}),this.pairing.on(f.PAIRING_EVENTS.settled,e=>{const t=f.CLIENT_EVENTS.pairing.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e),this.onPairingSettled(e)}),this.pairing.on(f.PAIRING_EVENTS.updated,(e,t)=>{const r=f.CLIENT_EVENTS.pairing.updated;this.logger.info("Emitting "+r),this.logger.debug({type:"event",event:r,data:e,update:t}),this.events.emit(r,e,t)}),this.pairing.on(f.PAIRING_EVENTS.upgraded,(e,t)=>{const r=f.CLIENT_EVENTS.pairing.upgraded;this.logger.info("Emitting "+r),this.logger.debug({type:"event",event:r,data:e,upgrade:t}),this.events.emit(r,e,t)}),this.pairing.on(f.PAIRING_EVENTS.deleted,(e,t)=>{const r=f.CLIENT_EVENTS.pairing.deleted;this.logger.info("Emitting "+r),this.logger.debug({type:"event",event:r,data:e,reason:t}),this.events.emit(r,e,t)}),this.pairing.on(f.PAIRING_EVENTS.request,e=>{this.onPairingRequest(e.request,e.topic)}),this.session.on(f.PAIRING_EVENTS.sync,()=>this.events.emit(f.CLIENT_EVENTS.pairing.sync)),this.session.on(f.SESSION_EVENTS.proposed,e=>{const t=f.CLIENT_EVENTS.session.proposal;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e.proposal}),this.events.emit(t,e.proposal)}),this.session.on(f.SESSION_EVENTS.settled,e=>{const t=f.CLIENT_EVENTS.session.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.updated,(e,t)=>{const r=f.CLIENT_EVENTS.session.updated;this.logger.info("Emitting "+r),this.logger.debug({type:"event",event:r,data:e,update:t}),this.events.emit(r,e,t)}),this.session.on(f.SESSION_EVENTS.upgraded,(e,t)=>{const r=f.CLIENT_EVENTS.session.upgraded;this.logger.info("Emitting "+r),this.logger.debug({type:"event",event:r,data:e,upgrade:t}),this.events.emit(r,e,t)}),this.session.on(f.SESSION_EVENTS.deleted,(e,t)=>{const r=f.CLIENT_EVENTS.session.deleted;this.logger.info("Emitting "+r),this.logger.debug({type:"event",event:r,data:e,reason:t}),this.events.emit(r,e,t)}),this.session.on(f.SESSION_EVENTS.request,e=>{const t=f.CLIENT_EVENTS.session.request;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.response,e=>{const t=f.CLIENT_EVENTS.session.response;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.notification,e=>{const t=f.CLIENT_EVENTS.session.notification;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.sync,()=>this.events.emit(f.CLIENT_EVENTS.session.sync))}}t.Client=h},function(e,t,r){"use strict";function n(e){try{return JSON.stringify(e)}catch(e){return'"[Circular]"'}}e.exports=function(e,t,r){var i=r&&r.stringify||n;if("object"==typeof e&&null!==e){var o=t.length+1;if(1===o)return e;var s=new Array(o);s[0]=i(e);for(var a=1;a<o;a++)s[a]=i(t[a]);return s.join(" ")}if("string"!=typeof e)return e;var c=t.length;if(0===c)return e;for(var u="",d=0,l=-1,f=e&&e.length||0,h=0;h<f;){if(37===e.charCodeAt(h)&&h+1<f){switch(l=l>-1?l:0,e.charCodeAt(h+1)){case 100:case 102:if(d>=c)break;if(null==t[d])break;l<h&&(u+=e.slice(l,h)),u+=Number(t[d]),l=h+2,h++;break;case 105:if(d>=c)break;if(null==t[d])break;l<h&&(u+=e.slice(l,h)),u+=Math.floor(Number(t[d])),l=h+2,h++;break;case 79:case 111:case 106:if(d>=c)break;if(void 0===t[d])break;l<h&&(u+=e.slice(l,h));var p=typeof t[d];if("string"===p){u+="'"+t[d]+"'",l=h+2,h++;break}if("function"===p){u+=t[d].name||"<anonymous>",l=h+2,h++;break}u+=i(t[d]),l=h+2,h++;break;case 115:if(d>=c)break;l<h&&(u+=e.slice(l,h)),u+=String(t[d]),l=h+2,h++;break;case 37:l<h&&(u+=e.slice(l,h)),u+="%",l=h+2,h++,d--}++d}++h}if(-1===l)return e;l<f&&(u+=e.slice(l));return u}},function(e,t,r){(function(t){!function(){"use strict";var r;function n(){}(r=n).prototype.getItem=function(e){return this.hasOwnProperty(e)?String(this[e]):null},r.prototype.setItem=function(e,t){this[e]=String(t)},r.prototype.removeItem=function(e){delete this[e]},r.prototype.clear=function(){var e=this;Object.keys(e).forEach((function(t){e[t]=void 0,delete e[t]}))},r.prototype.key=function(e){return e=e||0,Object.keys(this)[e]},r.prototype.__defineGetter__("length",(function(){return Object.keys(this).length})),t.localStorage?e.exports=localStorage:e.exports=new n}()}).call(this,r(25))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(91)),n(r(93))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(92);t.IKeyValueStorage=n.IKeyValueStorage},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IKeyValueStorage=class{}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(37);function i(e){return t.REACT_NATIVE_REQUIRED_OPTION in e}function o(e){return t.NODE_JS_REQUIRED_OPTION in e}t.REACT_NATIVE_REQUIRED_OPTION="asyncStorage",t.isReactNativeOptions=i,t.getReactNativeOptions=function(e){if(void 0===e||!i(e))throw new Error(`Missing ${t.REACT_NATIVE_REQUIRED_OPTION} option required for React-Native`);return e},t.NODE_JS_REQUIRED_OPTION="database",t.isNodeJSOptions=o,t.getNodeJSOptions=function(e){if(void 0===e||!o(e))throw new Error(`Missing ${t.NODE_JS_REQUIRED_OPTION} option required for NodeJS`);return e},t.parseEntry=function(e){return[e[0],n.safeJsonParse(e[1])]}},function(e,t,r){"use strict";(function(e){function r(){return(null==e?void 0:e.crypto)||(null==e?void 0:e.msCrypto)||{}}function n(){const e=r();return e.subtle||e.webkitSubtle}Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowserCryptoAvailable=t.getSubtleCrypto=t.getBrowerCrypto=void 0,t.getBrowerCrypto=r,t.getSubtleCrypto=n,t.isBrowserCryptoAvailable=function(){return!!r()&&!!n()}}).call(this,r(25))},function(e,t,r){"use strict";(function(e){function r(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function n(){return void 0!==e&&void 0!==e.versions&&void 0!==e.versions.node}Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowser=t.isNode=t.isReactNative=void 0,t.isReactNative=r,t.isNode=n,t.isBrowser=function(){return!r()&&!n()}}).call(this,r(58))},function(e,t,r){"use strict";t.byteLength=function(e){var t=u(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=u(e),s=n[0],a=n[1],c=new o(function(e,t,r){return 3*(t+r)/4-r}(0,s,a)),d=0,l=a>0?s-4:s;for(r=0;r<l;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],c[d++]=t>>16&255,c[d++]=t>>8&255,c[d++]=255&t;2===a&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,c[d++]=255&t);1===a&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,c[d++]=t>>8&255,c[d++]=255&t);return c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(d(e,s,s+16383>a?a:s+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function d(e,t,r){for(var i,o,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,u=c>>1,d=-7,l=r?i-1:0,f=r?-1:1,h=e[t+l];for(l+=f,o=h&(1<<-d)-1,h>>=-d,d+=a;d>0;o=256*o+e[t+l],l+=f,d-=8);for(s=o&(1<<-d)-1,o>>=-d,d+=n;d>0;s=256*s+e[t+l],l+=f,d-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,n),o-=u}return(h?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var s,a,c,u=8*o-i-1,d=(1<<u)-1,l=d>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,p=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(s++,c/=2),s+l>=d?(a=0,s=d):s+l>=1?(a=(t*c-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[r+h]=255&a,h+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[r+h]=255&s,h+=p,s/=256,u-=8);e[r+h-p]|=128*g}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){(function(t){var n=r(68).strict;e.exports=function(e){if(n(e)){var r=t.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(r=r.slice(e.byteOffset,e.byteOffset+e.byteLength)),r}return t.from(e)}}).call(this,r(67).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(101),i=r(105),o=r(31);function s(e,r){return void 0===r&&(r=t.defaultRandomSource),r.randomBytes(e)}t.defaultRandomSource=new n.SystemRandomSource,t.randomBytes=s,t.randomUint32=function(e){void 0===e&&(e=t.defaultRandomSource);var r=s(4,e),n=i.readUint32LE(r);return o.wipe(r),n};var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(e,r,n){if(void 0===r&&(r=a),void 0===n&&(n=t.defaultRandomSource),r.length<2)throw new Error("randomString charset is too short");if(r.length>256)throw new Error("randomString charset is too long");for(var i="",c=r.length,u=256-256%c;e>0;){for(var d=s(Math.ceil(256*e/u),n),l=0;l<d.length&&e>0;l++){var f=d[l];f<u&&(i+=r.charAt(f%c),e--)}o.wipe(d)}return i}t.randomString=c,t.randomStringForEntropy=function(e,r,n){return void 0===r&&(r=a),void 0===n&&(n=t.defaultRandomSource),c(Math.ceil(e/(Math.log(r.length)/Math.LN2)),r,n)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(102),i=r(103),o=function(){function e(){return this.isAvailable=!1,this.name="",this._source=new n.BrowserRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Browser")):(this._source=new i.NodeRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Node")):void 0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)},e}();t.SystemRandomSource=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.isAvailable=!1,this.isInstantiated=!1;var e="undefined"!=typeof self?self.crypto||self.msCrypto:null;e&&e.getRandomValues&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");for(var t=new Uint8Array(e),r=0;r<t.length;r+=65536)this._crypto.getRandomValues(t.subarray(r,r+Math.min(t.length-r,65536)));return t},e}();t.BrowserRandomSource=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(31),i=function(){function e(){this.isAvailable=!1,this.isInstantiated=!1;var e=r(104);e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");var t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");for(var r=new Uint8Array(e),i=0;i<r.length;i++)r[i]=t[i];return n.wipe(t),r},e}();t.NodeRandomSource=i},function(e,t){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(106);function i(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>8,t[r+1]=e>>>0,t}function o(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t}function s(e,t){return void 0===t&&(t=0),e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function a(e,t){return void 0===t&&(t=0),(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function c(e,t){return void 0===t&&(t=0),e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function u(e,t){return void 0===t&&(t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}function d(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>24,t[r+1]=e>>>16,t[r+2]=e>>>8,t[r+3]=e>>>0,t}function l(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24,t}function f(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),d(e/4294967296>>>0,t,r),d(e>>>0,t,r+4),t}function h(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),l(e>>>0,t,r),l(e/4294967296>>>0,t,r+4),t}t.readInt16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])<<16>>16},t.readUint16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])>>>0},t.readInt16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])<<16>>16},t.readUint16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])>>>0},t.writeUint16BE=i,t.writeInt16BE=i,t.writeUint16LE=o,t.writeInt16LE=o,t.readInt32BE=s,t.readUint32BE=a,t.readInt32LE=c,t.readUint32LE=u,t.writeUint32BE=d,t.writeInt32BE=d,t.writeUint32LE=l,t.writeInt32LE=l,t.readInt64BE=function(e,t){void 0===t&&(t=0);var r=s(e,t),n=s(e,t+4);return 4294967296*r+n-4294967296*(n>>31)},t.readUint64BE=function(e,t){return void 0===t&&(t=0),4294967296*a(e,t)+a(e,t+4)},t.readInt64LE=function(e,t){void 0===t&&(t=0);var r=c(e,t);return 4294967296*c(e,t+4)+r-4294967296*(r>>31)},t.readUint64LE=function(e,t){void 0===t&&(t=0);var r=u(e,t);return 4294967296*u(e,t+4)+r},t.writeUint64BE=f,t.writeInt64BE=f,t.writeUint64LE=h,t.writeInt64LE=h,t.readUintBE=function(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,i=1,o=e/8+r-1;o>=r;o--)n+=t[o]*i,i*=256;return n},t.readUintLE=function(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,i=1,o=r;o<r+e/8;o++)n+=t[o]*i,i*=256;return n},t.writeUintBE=function(e,t,r,i){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===i&&(i=0),e%8!=0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!n.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var o=1,s=e/8+i-1;s>=i;s--)r[s]=t/o&255,o*=256;return r},t.writeUintLE=function(e,t,r,i){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===i&&(i=0),e%8!=0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!n.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var o=1,s=i;s<i+e/8;s++)r[s]=t/o&255,o*=256;return r},t.readFloat32BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t)},t.readFloat32LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t,!0)},t.readFloat64BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t)},t.readFloat64LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t,!0)},t.writeFloat32BE=function(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e),t},t.writeFloat32LE=function(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e,!0),t},t.writeFloat64BE=function(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e),t},t.writeFloat64LE=function(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e,!0),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mul=Math.imul||function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0},t.add=function(e,t){return e+t|0},t.sub=function(e,t){return e-t|0},t.rotl=function(e,t){return e<<t|e>>>32-t},t.rotr=function(e,t){return e<<32-t|e>>>t},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(e){return t.isInteger(e)&&e>=-t.MAX_SAFE_INTEGER&&e<=t.MAX_SAFE_INTEGER}},function(e,t,r){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())},function(e,t,r){"use strict";var n=new RegExp("%[a-f0-9]{2}","gi"),i=new RegExp("(%[a-f0-9]{2})+","gi");function o(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],o(r),o(n))}function s(e){try{return decodeURIComponent(e)}catch(i){for(var t=e.match(n),r=1;r<t.length;r++)t=(e=o(t,r).join("")).match(n);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=i.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(e){var n=s(r[0]);n!==r[0]&&(t[r[0]]=n)}r=i.exec(e)}t["%C2"]="�";for(var o=Object.keys(t),a=0;a<o.length;a++){var c=o[a];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}},function(e,t,r){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]}},function(e,t,r){"use strict";e.exports=function(e,t){for(var r={},n=Object.keys(e),i=Array.isArray(t),o=0;o<n.length;o++){var s=n[o],a=e[s];(i?-1!==t.indexOf(s):t(s,a,e))&&(r[s]=a)}return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateChildLogger=t.formatChildLoggerContext=t.getLoggerContext=t.setBrowserLoggerContext=t.getBrowserLoggerContext=t.getDefaultLoggerOptions=void 0;const n=r(78);function i(e,t=n.PINO_CUSTOM_CONTEXT_KEY){return e[t]||""}function o(e,t,r=n.PINO_CUSTOM_CONTEXT_KEY){return e[r]=t,e}function s(e,t=n.PINO_CUSTOM_CONTEXT_KEY){let r="";return r=void 0===e.bindings?i(e,t):e.bindings().context||"",r}function a(e,t,r=n.PINO_CUSTOM_CONTEXT_KEY){const i=s(e,r);return i.trim()?`${i}/${t}`:t}t.getDefaultLoggerOptions=function(e){return Object.assign(Object.assign({},e),{level:(null==e?void 0:e.level)||n.PINO_LOGGER_DEFAULTS.level,prettyPrint:(null==e?void 0:e.prettyPrint)||n.PINO_LOGGER_DEFAULTS.prettyPrint})},t.getBrowserLoggerContext=i,t.setBrowserLoggerContext=o,t.getLoggerContext=s,t.formatChildLoggerContext=a,t.generateChildLogger=function(e,t,r=n.PINO_CUSTOM_CONTEXT_KEY){const i=a(e,t,r);return o(e.child({context:i}),i,r)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5);n.__exportStar(r(113),t),n.__exportStar(r(79),t),n.__exportStar(r(32),t),n.__exportStar(r(33),t),n.__exportStar(r(80),t),n.__exportStar(r(28),t),n.__exportStar(r(127),t),n.__exportStar(r(128),t),n.__exportStar(r(132),t),n.__exportStar(r(82),t),n.__exportStar(r(34),t),n.__exportStar(r(81),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Crypto=t.KeyChain=void 0;const n=r(5),i=n.__importStar(r(1)),o=r(11),s=r(19),a=r(12),c=r(9);class u{constructor(e,t){this.client=e,this.logger=t,this.keychain=new Map,this.name=c.KEYCHAIN_CONTEXT,this.client=e,this.logger=o.generateChildLogger(t,this.name)}get context(){return o.getLoggerContext(this.logger)}init(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.restore()}))}has(e,t){return n.__awaiter(this,void 0,void 0,(function*(){return this.keychain.has(e)}))}set(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){this.keychain.set(e,t),yield this.persist()}))}get(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const t=this.keychain.get(e);if(void 0===t)throw new Error(a.ERROR.NO_MATCHING_KEY.format({tag:e}).message);return t}))}del(e,t){return n.__awaiter(this,void 0,void 0,(function*(){this.keychain.delete(e),yield this.persist()}))}restore(){return n.__awaiter(this,void 0,void 0,(function*(){const e=yield this.client.storage.getKeyChain(this.context);void 0!==e&&(this.keychain=e)}))}persist(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.client.storage.setKeyChain(this.context,this.keychain)}))}}t.KeyChain=u;t.Crypto=class{constructor(e,t,r){this.client=e,this.logger=t,this.name=c.CRYPTO_CONTEXT,this.client=e,this.logger=o.generateChildLogger(t,this.name),this.keychain=r||new u(this.client,this.logger)}get context(){return o.getLoggerContext(this.logger)}init(){return n.__awaiter(this,void 0,void 0,(function*(){yield this.keychain.init()}))}hasKeys(e){return n.__awaiter(this,void 0,void 0,(function*(){return this.keychain.has(e)}))}generateKeyPair(){return n.__awaiter(this,void 0,void 0,(function*(){const e=a.generateKeyPair();return this.setKeyPair(e)}))}generateSharedKey(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){const n=yield this.getKeyPair(e.publicKey),i=a.deriveSharedKey(n.privateKey,t.publicKey);return this.setEncryptionKeys({sharedKey:i,publicKey:n.publicKey},r)}))}encrypt(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const{sharedKey:r,publicKey:n}=yield this.getEncryptionKeys(e);return yield a.encrypt({message:t,sharedKey:r,publicKey:n})}))}decrypt(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const{sharedKey:r}=yield this.getEncryptionKeys(e);return yield a.decrypt({encrypted:t,sharedKey:r})}))}encode(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=s.safeJsonStringify(t);return(yield this.hasKeys(e))?yield this.encrypt(e,r):i.utf8ToHex(r)}))}decode(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=(yield this.hasKeys(e))?yield this.decrypt(e,t):i.hexToUtf8(t);return s.safeJsonParse(r)}))}concatKeys(e,t){return i.arrayToHex(i.concatArrays(i.hexToArray(e),i.hexToArray(t)))}splitKeys(e){const t=i.hexToArray(e);return[i.arrayToHex(t.slice(0,32)),i.arrayToHex(t.slice(32,64))]}setKeyPair(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=this.concatKeys(e.publicKey,e.privateKey);return yield this.keychain.set(e.publicKey,t),e.publicKey}))}getKeyPair(e){return n.__awaiter(this,void 0,void 0,(function*(){const[t,r]=this.splitKeys(yield this.keychain.get(e));return{publicKey:e,privateKey:r}}))}setEncryptionKeys(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=t||(yield a.sha256(e.sharedKey)),n=this.concatKeys(e.sharedKey,e.publicKey);return yield this.keychain.set(r,n),r}))}getEncryptionKeys(e){return n.__awaiter(this,void 0,void 0,(function*(){const[t,r]=this.splitKeys(yield this.keychain.get(e));return{sharedKey:t,publicKey:r}}))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLIENT_STORAGE_OPTIONS=t.CLIENT_EVENTS=t.CLIENT_SHORT_TIMEOUT=t.CLIENT_DEFAULT=t.CLIENT_CONTEXT=void 0,t.CLIENT_CONTEXT="client",t.CLIENT_DEFAULT={name:t.CLIENT_CONTEXT,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},t.CLIENT_SHORT_TIMEOUT=50,t.CLIENT_EVENTS={pairing:{proposal:"pairing_proposal",updated:"pairing_updated",upgraded:"pairing_upgraded",created:"pairing_created",deleted:"pairing_deleted",sync:"pairing_sync"},session:{proposal:"session_proposal",updated:"session_updated",upgraded:"session_upgraded",created:"session_created",deleted:"session_deleted",notification:"session_notification",request:"session_request",response:"session_response",sync:"session_sync"}},t.CLIENT_STORAGE_OPTIONS={database:":memory:"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEYCHAIN_CONTEXT=t.CRYPTO_CONTEXT=void 0,t.CRYPTO_CONTEXT="crypto",t.KEYCHAIN_CONTEXT="keychain"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENCODER_CONTEXT=void 0,t.ENCODER_CONTEXT="encoder"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EXPIRER_DEFAULT_TTL=t.EXPIRER_EVENTS=t.EXPIRER_CONTEXT=void 0;const n=r(18);t.EXPIRER_CONTEXT="expirer",t.EXPIRER_EVENTS={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",init:"expirer_init",sync:"expirer_sync"},t.EXPIRER_DEFAULT_TTL=n.ONE_DAY},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HEARTBEAT_EVENTS=t.HEARTBEAT_DEFAULT_LOGGER=t.HEARTBEAT_INTERVAL=t.HEARTBEAT_CONTEXT=void 0;const n=r(18);t.HEARTBEAT_CONTEXT="heartbeat",t.HEARTBEAT_INTERVAL=n.FIVE_SECONDS,t.HEARTBEAT_DEFAULT_LOGGER="error",t.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HISTORY_CONTEXT=t.HISTORY_EVENTS=void 0,t.HISTORY_EVENTS={created:"history_created",updated:"history_updated",deleted:"history_deleted",init:"history_init",sync:"history_sync"},t.HISTORY_CONTEXT="history"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAIRING_EVENTS=t.PAIRING_STATUS=t.PAIRING_SIGNAL_METHOD_URI=t.PAIRING_DEFAULT_TTL=t.PAIRING_CONTEXT=t.PAIRING_JSONRPC=void 0;const n=r(18);t.PAIRING_JSONRPC={propose:"wc_pairingPropose",approve:"wc_pairingApprove",reject:"wc_pairingReject",update:"wc_pairingUpdate",upgrade:"wc_pairingUpgrade",delete:"wc_pairingDelete",payload:"wc_pairingPayload",ping:"wc_pairingPing",notification:"wc_pairingNotification"},t.PAIRING_CONTEXT="pairing",t.PAIRING_DEFAULT_TTL=n.THIRTY_DAYS,t.PAIRING_SIGNAL_METHOD_URI="uri",t.PAIRING_STATUS={proposed:"proposed",responded:"responded",pending:"pending",settled:"settled"},t.PAIRING_EVENTS={proposed:"pairing_proposed",responded:"pairing_responded",settled:"pairing_settled",updated:"pairing_updated",upgraded:"pairing_upgraded",deleted:"pairing_deleted",request:"pairing_request",response:"pairing_response",sync:"pairing_sync",notification:"pairing_notification"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PUBLISHER_CONTEXT=t.PUBLISHER_DEFAULT_TTL=void 0;const n=r(18);t.PUBLISHER_DEFAULT_TTL=n.SIX_HOURS,t.PUBLISHER_CONTEXT="publisher"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RELAYER_STORAGE_OPTIONS=t.RELAYER_RECONNECT_TIMEOUT=t.RELAYER_PROVIDER_EVENTS=t.RELAYER_SUBSCRIBER_SUFFIX=t.RELAYER_EVENTS=t.RELAYER_CONTEXT=t.RELAYER_DEFAULT_RELAY_URL=t.RELAYER_DEFAULT_LOGGER=t.RELAYER_DEFAULT_PROTOCOL=void 0;const n=r(18);t.RELAYER_DEFAULT_PROTOCOL="waku",t.RELAYER_DEFAULT_LOGGER="error",t.RELAYER_DEFAULT_RELAY_URL="wss://relay.walletconnect.com",t.RELAYER_CONTEXT="relayer",t.RELAYER_EVENTS={payload:"relayer_payload",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error"},t.RELAYER_SUBSCRIBER_SUFFIX="_subscription",t.RELAYER_PROVIDER_EVENTS={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},t.RELAYER_RECONNECT_TIMEOUT=n.ONE_SECOND,t.RELAYER_STORAGE_OPTIONS={database:":memory:"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SESSION_EMPTY_RESPONSE=t.SESSION_EMPTY_METADATA=t.SESSION_EMPTY_STATE=t.SESSION_EMPTY_PERMISSIONS=t.SESSION_EVENTS=t.SESSION_STATUS=t.SESSION_SIGNAL_METHOD_PAIRING=t.SESSION_DEFAULT_TTL=t.SESSION_CONTEXT=t.SESSION_JSONRPC=void 0;const n=r(18);t.SESSION_JSONRPC={propose:"wc_sessionPropose",approve:"wc_sessionApprove",reject:"wc_sessionReject",update:"wc_sessionUpdate",upgrade:"wc_sessionUpgrade",delete:"wc_sessionDelete",payload:"wc_sessionPayload",ping:"wc_sessionPing",notification:"wc_sessionNotification"},t.SESSION_CONTEXT="session",t.SESSION_DEFAULT_TTL=n.SEVEN_DAYS,t.SESSION_SIGNAL_METHOD_PAIRING="pairing",t.SESSION_STATUS={proposed:"proposed",responded:"responded",pending:"pending",settled:"settled"},t.SESSION_EVENTS={proposed:"session_proposed",responded:"session_responded",settled:"session_settled",updated:"session_updated",upgraded:"session_upgraded",deleted:"session_deleted",request:"session_request",response:"session_response",sync:"session_sync",notification:"session_notification"},t.SESSION_EMPTY_PERMISSIONS={jsonrpc:{methods:[]},blockchain:{chains:[]},notifications:{types:[]}},t.SESSION_EMPTY_STATE={accounts:[]},t.SESSION_EMPTY_METADATA={name:"",description:"",url:"",icons:[]},t.SESSION_EMPTY_RESPONSE={metadata:t.SESSION_EMPTY_METADATA,state:t.SESSION_EMPTY_STATE}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORE_EVENTS=void 0,t.STORE_EVENTS={created:"store_created",updated:"store_updated",deleted:"store_deleted",init:"store_init",sync:"store_sync"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_KEYS=t.STORAGE_VERSION=t.STORAGE_CONTEXT=void 0,t.STORAGE_CONTEXT="storage",t.STORAGE_VERSION="0.2",t.STORAGE_KEYS={crypto:{keychain:"crypto:keychain"},session:{pending:"session:pending",settled:"session:settled",history:"session:history",expirer:"session:expirer"},pairing:{pending:"pairing:pending",settled:"pairing:settled",history:"pairing:history",expirer:"pairing:expirer"},relayer:{history:"relayer:history",subscription:"relayer:subscription"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUBSCRIBER_CONTEXT=t.SUBSCRIBER_DEFAULT_TTL=t.SUBSCRIBER_EVENTS=void 0;const n=r(18);t.SUBSCRIBER_EVENTS={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",enabled:"subscription_enabled",disabled:"subscription_disabled",sync:"subscription_sync"},t.SUBSCRIBER_DEFAULT_TTL=n.THIRTY_DAYS,t.SUBSCRIBER_CONTEXT="subscription"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pairing=void 0;const n=r(5),i=r(10),o=r(11),s=r(17),a=r(12),c=r(34),u=r(32),d=r(28),l=r(33),f=r(9);class h extends s.IPairing{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.events=new i.EventEmitter,this.name=f.PAIRING_CONTEXT,this.config={status:f.PAIRING_STATUS,events:f.PAIRING_EVENTS,jsonrpc:f.PAIRING_JSONRPC},this.logger=o.generateChildLogger(t,this.name),this.pending=new c.Store(e,this.logger,this.config.status.pending),this.settled=new c.Store(e,this.logger,this.config.status.settled),this.history=new d.JsonRpcHistory(this.logger,this.client.storage),this.expirer=new l.Expirer(e,this.logger),this.engine=new u.Engine(this)}init(){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.pending.init(),yield this.settled.init(),yield this.history.init(),yield this.expirer.init()}))}get(e){return this.settled.get(e)}find(e){return this.engine.find(e)}ping(e,t){return this.engine.ping(e,t)}send(e,t){return this.engine.send(e,t)}get context(){return o.getLoggerContext(this.logger)}get length(){return this.settled.length}get topics(){return this.settled.topics}get values(){return this.settled.values}create(e){return this.engine.create(e)}respond(e){return this.engine.respond(e)}upgrade(e){return this.engine.upgrade(e)}update(e){return this.engine.update(e)}request(e){return this.engine.request(e)}delete(e){return this.engine.delete(e)}notify(e){return this.engine.notify(e)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}mergeUpdate(e,t){return n.__awaiter(this,void 0,void 0,(function*(){const r=yield this.settled.get(e);return{metadata:t.state.metadata||r.state.metadata}}))}mergeUpgrade(e,t){var r,i,o;return n.__awaiter(this,void 0,void 0,(function*(){const n=yield this.settled.get(e);return{jsonrpc:{methods:a.mergeArrays(n.permissions.jsonrpc.methods,(null===(r=t.permissions.jsonrpc)||void 0===r?void 0:r.methods)||[])},notifications:{types:a.mergeArrays((null===(i=n.permissions.notifications)||void 0===i?void 0:i.types)||[],(null===(o=t.permissions.notifications)||void 0===o?void 0:o.types)||[])},controller:n.permissions.controller}}))}validateRespond(e){return n.__awaiter(this,void 0,void 0,(function*(){}))}validateRequest(e){return n.__awaiter(this,void 0,void 0,(function*(){}))}validatePropose(e){return n.__awaiter(this,void 0,void 0,(function*(){}))}getDefaultSignal({topic:e,relay:t,proposer:r}){return n.__awaiter(this,void 0,void 0,(function*(){const n=a.formatUri({protocol:this.client.protocol,version:this.client.version,topic:e,publicKey:r.publicKey,controller:r.controller,relay:t});return{method:f.PAIRING_SIGNAL_METHOD_URI,params:{uri:n}}}))}getDefaultTTL(){return n.__awaiter(this,void 0,void 0,(function*(){return f.PAIRING_DEFAULT_TTL}))}getDefaultPermissions(){return n.__awaiter(this,void 0,void 0,(function*(){return{jsonrpc:{methods:[f.SESSION_JSONRPC.propose]},notifications:{types:[]}}}))}}t.Pairing=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Relayer=void 0;const n=r(5),i=r(10),o=n.__importDefault(r(30)),s=n.__importDefault(r(36)),a=r(11),c=r(17),u=r(12),d=r(133),l=n.__importDefault(r(129)),f=r(8),h=r(81),p=r(9),g=r(28),E=r(82),y=r(79),_=r(80),v=r(131);class R extends c.IRelayer{constructor(e){super(e),this.protocol="irn",this.version=1,this.events=new i.EventEmitter,this.name=p.RELAYER_CONTEXT,this.logger=void 0!==(null==e?void 0:e.logger)&&"string"!=typeof(null==e?void 0:e.logger)?a.generateChildLogger(e.logger,this.name):o.default(a.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||p.RELAYER_DEFAULT_LOGGER}));const t=Object.assign(Object.assign({},p.RELAYER_STORAGE_OPTIONS),null==e?void 0:e.keyValueStorageOptions);this.storage=void 0!==(null==e?void 0:e.storage)?e.storage:new E.RelayerStorage(this.logger,(null==e?void 0:e.keyValueStorage)||new s.default(t),{protocol:this.protocol,version:this.version,context:this.context}),this.heartbeat=(null==e?void 0:e.heartbeat)||new _.HeartBeat({logger:this.logger}),this.encoder=(null==e?void 0:e.encoder)||new y.RelayerEncoder;const r=(null==e?void 0:e.rpcUrl)||u.formatRelayRpcUrl(this.protocol,this.version,p.RELAYER_DEFAULT_RELAY_URL,null==e?void 0:e.projectId);this.provider="string"!=typeof(null==e?void 0:e.relayProvider)&&void 0!==(null==e?void 0:e.relayProvider)?null==e?void 0:e.relayProvider:new d.JsonRpcProvider(new l.default(r)),this.history=new g.JsonRpcHistory(this.logger,this.storage),this.subscriber=new h.Subscriber(this,this.logger),this.publisher=new v.Publisher(this,this.logger),this.registerEventListeners()}get context(){return a.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}init(){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.history.init(),yield this.provider.connect(),yield this.subscriber.init(),yield this.publisher.init()}))}publish(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){yield this.publisher.publish(e,t,r),yield this.recordPayloadEvent({topic:e,payload:t})}))}subscribe(e,t){return n.__awaiter(this,void 0,void 0,(function*(){return yield this.subscriber.subscribe(e,t)}))}unsubscribe(e,t){return n.__awaiter(this,void 0,void 0,(function*(){yield this.subscriber.unsubscribe(e,t)}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}recordPayloadEvent(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r}=e;f.isJsonRpcRequest(r)?yield this.history.set(t,r):yield this.history.resolve(r)}))}shouldIgnorePayloadEvent(e){return n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r}=e;if(!this.subscriber.topics.includes(t))return!0;let n=!1;try{if(f.isJsonRpcRequest(r))n=yield this.history.exists(t,r.id);else{let e;try{e=yield this.history.get(t,r.id)}catch(e){}n=void 0!==e&&void 0!==e.response}}catch(e){}return n}))}onPayload(e){return n.__awaiter(this,void 0,void 0,(function*(){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),f.isJsonRpcRequest(e)){if(!e.method.endsWith(p.RELAYER_SUBSCRIBER_SUFFIX))return;const t=e.params,{topic:r,message:n}=t.data,i={topic:r,payload:yield this.encoder.decode(r,n)};if(yield this.shouldIgnorePayloadEvent(i))return;this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Object.assign({type:"event",event:t.id},i)),this.events.emit(t.id,i),this.events.emit(p.RELAYER_EVENTS.payload,i),yield this.acknowledgePayload(e),yield this.recordPayloadEvent(i)}}))}acknowledgePayload(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=f.formatJsonRpcResult(e.id,!0);yield this.provider.connection.send(t)}))}registerEventListeners(){this.provider.on(p.RELAYER_PROVIDER_EVENTS.payload,e=>this.onPayload(e)),this.provider.on(p.RELAYER_PROVIDER_EVENTS.connect,()=>n.__awaiter(this,void 0,void 0,(function*(){this.events.emit(p.RELAYER_EVENTS.connect)}))),this.provider.on(p.RELAYER_PROVIDER_EVENTS.disconnect,()=>n.__awaiter(this,void 0,void 0,(function*(){this.events.emit(p.RELAYER_EVENTS.disconnect),setTimeout(()=>{this.provider.connect()},p.RELAYER_RECONNECT_TIMEOUT)}))),this.provider.on(p.RELAYER_PROVIDER_EVENTS.error,e=>this.events.emit(p.RELAYER_EVENTS.error,e))}}t.Relayer=R},function(e,t,r){"use strict";r.r(t);var n=r(29);r.d(t,"WsConnection",(function(){return n.a})),t.default=n.b},function(e,t,r){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Publisher=t.IPublisher=void 0;const n=r(5),i=r(10),o=r(11),s=r(12),a=r(2),c=r(9);class u extends a.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}t.IPublisher=u;t.Publisher=class extends u{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new i.EventEmitter,this.name=c.PUBLISHER_CONTEXT,this.queue=new Map,this.relayer=e,this.logger=o.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return o.getLoggerContext(this.logger)}init(){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}publish(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,payload:t,opts:r}});try{const n=(null==r?void 0:r.ttl)||c.PUBLISHER_DEFAULT_TTL,i=s.getRelayProtocolName(r),o={topic:e,payload:t,opts:{ttl:n,relay:i}};this.queue.set(t.id,o);const a=yield this.relayer.encoder.encode(e,t);yield this.rpcPublish(e,a,n,i),yield this.onPublish(t.id,o),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,payload:t,opts:r}})}catch(e){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(e),e}}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}initialize(){return n.__awaiter(this,void 0,void 0,(function*(){}))}rpcPublish(e,t,r,i){return n.__awaiter(this,void 0,void 0,(function*(){const n={method:s.getRelayProtocolApi(i.protocol).publish,params:{topic:e,message:t,ttl:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.provider.request(n)}))}onPublish(e,t){return n.__awaiter(this,void 0,void 0,(function*(){this.queue.delete(e)}))}checkQueue(){this.queue.forEach(e=>n.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:r,opts:{ttl:n,relay:i}}=e,o=yield this.relayer.encoder.encode(t,r);yield this.rpcPublish(t,o,n,i),yield this.onPublish(r.id,e)})))}registerEventListeners(){this.relayer.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;const n=r(5),i=r(10),o=r(11),s=r(17),a=r(12),c=r(34),u=r(32),d=r(28),l=r(33),f=r(9);class h extends s.ISession{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.events=new i.EventEmitter,this.name=f.SESSION_CONTEXT,this.config={status:f.SESSION_STATUS,events:f.SESSION_EVENTS,jsonrpc:f.SESSION_JSONRPC},this.logger=o.generateChildLogger(t,this.name),this.pending=new c.Store(e,this.logger,this.config.status.pending),this.settled=new c.Store(e,this.logger,this.config.status.settled),this.history=new d.JsonRpcHistory(this.logger,this.client.storage),this.expirer=new l.Expirer(e,this.logger),this.engine=new u.Engine(this)}init(){return n.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.pending.init(),yield this.settled.init(),yield this.history.init(),yield this.expirer.init()}))}get(e){return this.settled.get(e)}find(e){return this.engine.find(e)}ping(e,t){return this.engine.ping(e,t)}send(e,t,r){return this.engine.send(e,t,r)}get context(){return o.getLoggerContext(this.logger)}get length(){return this.settled.length}get topics(){return this.settled.topics}get values(){return this.settled.values}create(e){return this.engine.create(e)}respond(e){return this.engine.respond(e)}upgrade(e){return this.engine.upgrade(e)}update(e){return this.engine.update(e)}request(e){return this.engine.request(e)}delete(e){return this.engine.delete(e)}notify(e){return this.engine.notify(e)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}mergeUpdate(e,t){var r;return n.__awaiter(this,void 0,void 0,(function*(){const n=yield this.settled.get(e);return{accounts:(null===(r=t.state)||void 0===r?void 0:r.accounts)||n.state.accounts}}))}mergeUpgrade(e,t){var r,i,o,s,c;return n.__awaiter(this,void 0,void 0,(function*(){const n=yield this.settled.get(e);return{jsonrpc:{methods:a.mergeArrays(n.permissions.jsonrpc.methods,(null===(r=t.permissions.jsonrpc)||void 0===r?void 0:r.methods)||[])},notifications:{types:a.mergeArrays((null===(i=n.permissions.notifications)||void 0===i?void 0:i.types)||[],(null===(o=t.permissions.notifications)||void 0===o?void 0:o.types)||[])},blockchain:{chains:a.mergeArrays((null===(s=n.permissions.blockchain)||void 0===s?void 0:s.chains)||[],(null===(c=t.permissions.blockchain)||void 0===c?void 0:c.chains)||[])},controller:n.permissions.controller}}))}validateRespond(e){return n.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=a.ERROR.MISSING_OR_INVALID.format({name:"respond params"});throw this.logger.error(e.message),new Error(e.message)}const t=a.validateSessionRespondParams(e);if(a.isValidationInvalid(t))throw this.logger.error(t.error.message),new Error(t.error.message)}))}validateRequest(e){return n.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=a.ERROR.MISSING_OR_INVALID.format({name:"request params"});throw this.logger.error(e.message),new Error(e.message)}const{topic:t,chainId:r}=e,n=yield this.settled.get(t);if(r&&!n.permissions.blockchain.chains.includes(r)){const e=a.ERROR.UNAUTHORIZED_TARGET_CHAIN.format({chainId:r});throw this.logger.error(e.message),new Error(e.message)}}))}validatePropose(e){return n.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=a.ERROR.MISSING_OR_INVALID.format({name:"propose params"});throw this.logger.error(e.message),new Error(e.message)}const t=a.validateSessionProposeParams(e);if(a.isValidationInvalid(t))throw this.logger.error(t.error.message),new Error(t.error.message);if(e.signal.method!==f.SESSION_SIGNAL_METHOD_PAIRING){const e=a.ERROR.UNSUPPORTED_SIGNAL.format({context:this.context});throw this.logger.error(e.message),new Error(e.message)}}))}getDefaultSignal(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=yield this.client.pairing.settled.get(e.topic);return{method:f.SESSION_SIGNAL_METHOD_PAIRING,params:{topic:t.topic}}}))}getDefaultTTL(){return n.__awaiter(this,void 0,void 0,(function*(){return f.SESSION_DEFAULT_TTL}))}getDefaultPermissions(){return n.__awaiter(this,void 0,void 0,(function*(){return{jsonrpc:{methods:[]},notifications:{types:[]},blockchain:{chains:[]}}}))}}t.Session=h},function(e,t,r){"use strict";r.r(t),r.d(t,"JsonRpcProvider",(function(){return o}));var n=r(10),i=r(8);class o extends i.IJsonRpcProvider{constructor(e){super(e),this.events=new n.EventEmitter,this.connection=this.setConnection(e)}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Object(i.formatJsonRpcRequest)(e.method,e.params||[]),t)}async requestStrict(e,t){return new Promise(async(r,n)=>{if(!this.connection.connected)try{await this.open()}catch(e){n(e)}this.events.on(""+e.id,e=>{Object(i.isJsonRpcError)(e)?n(e.error.message):r(e.result)});try{await this.connection.send(e,t)}catch(e){n(e)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Object(i.isJsonRpcResponse)(e)?this.events.emit(""+e.id,e):this.events.emit("message",{type:e.method,data:e.params})}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof e&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",()=>this.events.emit("disconnect")),this.connection.on("error",e=>this.events.emit("error",e)),this.events.emit("connect"))}async close(){await this.connection.close(),this.events.emit("disconnect")}}var s=o;t.default=s}])}));